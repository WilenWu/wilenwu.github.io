<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Python手册(Machine Learning)--statsmodels | 雷小小</title><meta name="author" content="Tiny Lei"><meta name="copyright" content="Tiny Lei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="统计建模和计量经济学">
<meta property="og:type" content="article">
<meta property="og:title" content="Python手册(Machine Learning)--statsmodels">
<meta property="og:url" content="https://www.tinylei.tech/posts/6c94e349/index.html">
<meta property="og:site_name" content="雷小小">
<meta property="og:description" content="统计建模和计量经济学">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.tinylei.tech/img/statsmodels.svg">
<meta property="article:published_time" content="2018-05-10T15:12:43.000Z">
<meta property="article:modified_time" content="2022-03-27T10:12:32.261Z">
<meta property="article:author" content="Tiny Lei">
<meta property="article:tag" content="机器学习">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.tinylei.tech/img/statsmodels.svg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.tinylei.tech/posts/6c94e349/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-7rymn5Bitx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?654e7415ab55bed7c9c2bc6d665f03c5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python手册(Machine Learning)--statsmodels',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-27 18:12:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2849223_xh1ftc8qym.css"><link rel="stylesheet" href="/css/link-card.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="雷小小" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">134</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">103</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">42</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/user-guide/"><i class="fa-fw fa fa-compass"></i><span> 用户指南</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-book"></i><span> 文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-images"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/ebook/"><i class="fa-fw fa fa-book-reader"></i><span> 电子书</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-star"></i><span> 收藏夹</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-solid fa-circle-chevron-down"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-user"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/analytics/"><i class="fa-fw fa fa-line-chart"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/log/"><i class="fa-fw fa fa-history"></i><span> 更新日志</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/statsmodels.svg')"><nav id="nav"><span id="blog-info"><a href="/" title="雷小小"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png"/><span class="site-name">雷小小</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/user-guide/"><i class="fa-fw fa fa-compass"></i><span> 用户指南</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-book"></i><span> 文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-images"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/ebook/"><i class="fa-fw fa fa-book-reader"></i><span> 电子书</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-star"></i><span> 收藏夹</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa-solid fa-circle-chevron-down"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-user"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/analytics/"><i class="fa-fw fa fa-line-chart"></i><span> 文章统计</span></a></li><li><a class="site-page child" href="/log/"><i class="fa-fw fa fa-history"></i><span> 更新日志</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Python手册(Machine Learning)--statsmodels<a class="post-edit-link" href="https://gitee.com/WilenWu/myblog/edit/master/source/_posts/python/Python(Machine-Learning)--statsmodels.md" rel="external nofollow noreferrer" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2018-05-10T15:12:43.000Z" title="发表于 2018-05-10 23:12:43">2018-05-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-27T10:12:32.261Z" title="更新于 2022-03-27 18:12:32">2022-03-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/python/machine-learning/">Machine Learning</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">14.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>62分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Python手册(Machine Learning)--statsmodels"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>与scikit-learn比较，statsmodels包含经典统计学和经济计量学的算法。包括如下子模块：</p>
<ul>
<li>回归模型：线性回归，广义线性模型，健壮线性模型，线性混合效应模型等等。</li>
<li>方差分析（ANOVA）。</li>
<li>时间序列分析：AR，ARMA，ARIMA，VAR和其它模型。</li>
<li>非参数方法： 核密度估计，核回归。</li>
<li>统计模型结果可视化。</li>
</ul>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/index.html#table-of-contents">statsmodels</a>更关注统计推断，提供不确定估计和参数p-value。相反的，scikit-learn注重预测。</p>
<span id="more"></span>  
<h1 id="入门"><a class="markdownIt-Anchor" href="#入门"></a> 入门</h1>
<h2 id="模型拟合和描述"><a class="markdownIt-Anchor" href="#模型拟合和描述"></a> 模型拟合和描述</h2>
<p>拟合模型<code>statsmodels</code>通常包括 3 个简单的步骤：</p>
<ol>
<li>使用模型类来描述模型</li>
<li>使用类方法拟合模型</li>
<li>使用汇总方法检查结果</li>
</ol>
<p>对于 OLS，这是通过以下方式实现的：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> statsmodels.formula.api <span class="keyword">as</span> smf  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pandas  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df = sm.datasets.get_rdataset(<span class="string">&quot;Guerry&quot;</span>, <span class="string">&quot;HistData&quot;</span>).data  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>df = df.dropna()  </span><br><span class="line"><span class="comment"># step 1 Describe model,return model class  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mod = smf.ols(formula=<span class="string">&#x27;Lottery ~ Literacy + Wealth + Region&#x27;</span>, data=df)  </span><br><span class="line"><span class="comment"># step 2 Fit model,return result class  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res = mod.fit()  </span><br><span class="line"><span class="comment"># step 3 Summarize model  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(res.summary())  </span><br><span class="line"> OLS Regression Results                              </span><br><span class="line">==============================================================================  </span><br><span class="line">Dep. Variable:                Lottery   R-squared:                       <span class="number">0.338</span>  </span><br><span class="line">Model:                            OLS   Adj. R-squared:                  <span class="number">0.287</span>  </span><br><span class="line">Method:                 Least Squares   F-statistic:                     <span class="number">6.636</span>  </span><br><span class="line">Date:                Sun, <span class="number">23</span> Dec <span class="number">2018</span>   Prob (F-statistic):           <span class="number">1.07e-05</span>  </span><br><span class="line">Time:                        <span class="number">18</span>:<span class="number">41</span>:<span class="number">19</span>   Log-Likelihood:                -<span class="number">375.30</span>  </span><br><span class="line">No. Observations:                  <span class="number">85</span>   AIC:                             <span class="number">764.6</span>  </span><br><span class="line">Df Residuals:                      <span class="number">78</span>   BIC:                             <span class="number">781.7</span>  </span><br><span class="line">Df Model:                           <span class="number">6</span>                                           </span><br><span class="line">Covariance <span class="type">Type</span>:            nonrobust                                           </span><br><span class="line">===============================================================================  </span><br><span class="line">                  coef    std err          t      P&gt;|t|      [<span class="number">0.025</span>      <span class="number">0.975</span>]  </span><br><span class="line">-------------------------------------------------------------------------------  </span><br><span class="line">Intercept      <span class="number">38.6517</span>      <span class="number">9.456</span>      <span class="number">4.087</span>      <span class="number">0.000</span>      <span class="number">19.826</span>      <span class="number">57.478</span>  </span><br><span class="line">Region[T.E]   -<span class="number">15.4278</span>      <span class="number">9.727</span>     -<span class="number">1.586</span>      <span class="number">0.117</span>     -<span class="number">34.793</span>       <span class="number">3.938</span>  </span><br><span class="line">Region[T.N]   -<span class="number">10.0170</span>      <span class="number">9.260</span>     -<span class="number">1.082</span>      <span class="number">0.283</span>     -<span class="number">28.453</span>       <span class="number">8.419</span>  </span><br><span class="line">Region[T.S]    -<span class="number">4.5483</span>      <span class="number">7.279</span>     -<span class="number">0.625</span>      <span class="number">0.534</span>     -<span class="number">19.039</span>       <span class="number">9.943</span>  </span><br><span class="line">Region[T.W]   -<span class="number">10.0913</span>      <span class="number">7.196</span>     -<span class="number">1.402</span>      <span class="number">0.165</span>     -<span class="number">24.418</span>       <span class="number">4.235</span>  </span><br><span class="line">Literacy       -<span class="number">0.1858</span>      <span class="number">0.210</span>     -<span class="number">0.886</span>      <span class="number">0.378</span>      -<span class="number">0.603</span>       <span class="number">0.232</span>  </span><br><span class="line">Wealth          <span class="number">0.4515</span>      <span class="number">0.103</span>      <span class="number">4.390</span>      <span class="number">0.000</span>       <span class="number">0.247</span>       <span class="number">0.656</span>  </span><br><span class="line">==============================================================================  </span><br><span class="line">Omnibus:                        <span class="number">3.049</span>   Durbin-Watson:                   <span class="number">1.785</span>  </span><br><span class="line">Prob(Omnibus):                  <span class="number">0.218</span>   Jarque-Bera (JB):                <span class="number">2.694</span>  </span><br><span class="line">Skew:                          -<span class="number">0.340</span>   Prob(JB):                        <span class="number">0.260</span>  </span><br><span class="line">Kurtosis:                       <span class="number">2.454</span>   Cond. No.                         <span class="number">371.</span>  </span><br><span class="line">==============================================================================  </span><br><span class="line">  </span><br><span class="line">Warnings:  </span><br><span class="line">[<span class="number">1</span>] Standard Errors assume that the covariance matrix of the errors <span class="keyword">is</span> correctly specified.  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res.params  <span class="comment"># 获取模型参数  </span></span><br><span class="line">Intercept      <span class="number">38.651655</span>  </span><br><span class="line">Region[T.E]   -<span class="number">15.427785</span>  </span><br><span class="line">Region[T.N]   -<span class="number">10.016961</span>  </span><br><span class="line">Region[T.S]    -<span class="number">4.548257</span>  </span><br><span class="line">Region[T.W]   -<span class="number">10.091276</span>  </span><br><span class="line">Literacy       -<span class="number">0.185819</span>  </span><br><span class="line">Wealth          <span class="number">0.451475</span>  </span><br><span class="line">dtype: float64  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(res)    <span class="comment"># 查看完整的属性列表  </span></span><br></pre></td></tr></table></figure>
<h2 id="输入输出模型"><a class="markdownIt-Anchor" href="#输入输出模型"></a> 输入输出模型</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> statsmodels.iolib <span class="keyword">import</span> smpickle  </span><br><span class="line">smpickle.save_pickle(obj, fname)	<span class="comment">#Save the object to file via pickling.  </span></span><br><span class="line">smpickle.load_pickle(fname)	<span class="comment">#Load a previously saved object from file  </span></span><br></pre></td></tr></table></figure>
<h2 id="模型测试和绘图"><a class="markdownIt-Anchor" href="#模型测试和绘图"></a> 模型测试和绘图</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment">#Rainbow测试线性度（零假设是关系被正确建模为线性)  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sm.stats.linear_rainbow(res)  </span><br><span class="line">(<span class="number">0.847233997615691</span>, <span class="number">0.6997965543621644</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sm.graphics.plot_partregress(<span class="string">&#x27;Lottery&#x27;</span>, <span class="string">&#x27;Wealth&#x27;</span>, [<span class="string">&#x27;Region&#x27;</span>, <span class="string">&#x27;Literacy&#x27;</span>],  </span><br><span class="line">      data=df, obs_labels=<span class="literal">False</span>) <span class="comment">#绘制回归图  </span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/line.png" alt="line" /></p>
<h2 id="使用r型公式来拟合模型"><a class="markdownIt-Anchor" href="#使用r型公式来拟合模型"></a> 使用R型公式来拟合模型</h2>
<p><code>import statsmodels.formula.api as smf</code></p>
<table>
<thead>
<tr>
<th>formula</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>~</td>
<td style="text-align:left">分隔符，左边为响应变量，右边为解释变量</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>+</td>
<td style="text-align:left">添加变量</td>
<td style="text-align:left">y~x+y</td>
</tr>
<tr>
<td>-</td>
<td style="text-align:left">移除变量</td>
<td style="text-align:left">y~x<em>z</em>w–x:z:w可展开为 y ~ (x + z + w)**2</td>
</tr>
<tr>
<td>-</td>
<td style="text-align:left">移除变量</td>
<td style="text-align:left">y~x-1(移除截距)</td>
</tr>
<tr>
<td>:</td>
<td style="text-align:left">预测变量交互项</td>
<td style="text-align:left">y~x+y+x:y</td>
</tr>
<tr>
<td>*</td>
<td style="text-align:left">包含所有交互项的简洁方式</td>
<td style="text-align:left">代码y~ x * z可展开为y ~ x + z + x:z</td>
</tr>
<tr>
<td>**</td>
<td style="text-align:left">交互项的最高次数</td>
<td style="text-align:left">代码 y ~ (x + z + w)**2 可展开为 y ~ x + z + w + x:z + x:w + z:w</td>
</tr>
<tr>
<td>C()</td>
<td style="text-align:left"><strong>处理分类变量</strong></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>function</td>
<td style="text-align:left">数学函数</td>
<td style="text-align:left">log(y) ~ x + z + w</td>
</tr>
</tbody>
</table>
<p><strong>支持R型公式的模型</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">15</span>] res = smf.ols(formula=<span class="string">&#x27;Lottery ~ Literacy + Wealth + C(Region) -1 &#x27;</span>, data=df).fit()  </span><br></pre></td></tr></table></figure>
<p><strong>不支持R型公式的模型，使用<a target="_blank" rel="noopener external nofollow noreferrer" href="https://patsy.readthedocs.io/en/latest/overview.html">patsy</a> 模块</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Using formulas with models that do not (yet) support them  </span></span><br><span class="line">In [<span class="number">22</span>]: <span class="keyword">import</span> patsy  </span><br><span class="line">In [<span class="number">23</span>]: f = <span class="string">&#x27;Lottery ~ Literacy * Wealth&#x27;</span>  </span><br><span class="line">In [<span class="number">24</span>]: y, X = patsy.dmatrices(f, df, return_type=<span class="string">&#x27;matrix&#x27;</span>)  </span><br><span class="line"> <span class="comment">#y被转化为patsy.DesignMatrix,x被转化为转化为numpy.ndarray  </span></span><br><span class="line">In [<span class="number">26</span>]: <span class="built_in">print</span>(X[:<span class="number">5</span>])  </span><br><span class="line">[[   <span class="number">1.</span>   <span class="number">37.</span>   <span class="number">73.</span> <span class="number">2701.</span>]  </span><br><span class="line"> [   <span class="number">1.</span>   <span class="number">51.</span>   <span class="number">22.</span> <span class="number">1122.</span>]  </span><br><span class="line"> [   <span class="number">1.</span>   <span class="number">13.</span>   <span class="number">61.</span>  <span class="number">793.</span>]  </span><br><span class="line"> [   <span class="number">1.</span>   <span class="number">46.</span>   <span class="number">76.</span> <span class="number">3496.</span>]  </span><br><span class="line"> [   <span class="number">1.</span>   <span class="number">69.</span>   <span class="number">83.</span> <span class="number">5727.</span>]]  </span><br><span class="line">In [<span class="number">27</span>]: f = <span class="string">&#x27;Lottery ~ Literacy * Wealth&#x27;</span>  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">28</span>]: y, X = patsy.dmatrices(f, df, return_type=<span class="string">&#x27;dataframe&#x27;</span>) <span class="comment">#转化为pandas.dataframe  </span></span><br><span class="line">In [<span class="number">30</span>]: <span class="built_in">print</span>(X[:<span class="number">5</span>])  </span><br><span class="line">   Intercept  Literacy  Wealth  Literacy:Wealth  </span><br><span class="line"><span class="number">0</span>        <span class="number">1.0</span>      <span class="number">37.0</span>    <span class="number">73.0</span>           <span class="number">2701.0</span>  </span><br><span class="line"><span class="number">1</span>        <span class="number">1.0</span>      <span class="number">51.0</span>    <span class="number">22.0</span>           <span class="number">1122.0</span>  </span><br><span class="line"><span class="number">2</span>        <span class="number">1.0</span>      <span class="number">13.0</span>    <span class="number">61.0</span>            <span class="number">793.0</span>  </span><br><span class="line"><span class="number">3</span>        <span class="number">1.0</span>      <span class="number">46.0</span>    <span class="number">76.0</span>           <span class="number">3496.0</span>  </span><br><span class="line"><span class="number">4</span>        <span class="number">1.0</span>      <span class="number">69.0</span>    <span class="number">83.0</span>           <span class="number">5727.0</span>  </span><br><span class="line">In [<span class="number">31</span>]: res=smf.OLS(y, X).fit()  </span><br></pre></td></tr></table></figure>
<h2 id="statsmodels参数"><a class="markdownIt-Anchor" href="#statsmodels参数"></a> statsmodels参数</h2>
<p>Statsmodels使用endog和exog为模型数据参数名称，作为估计器的观测变量。</p>
<table>
<thead>
<tr>
<th style="text-align:left">endog</th>
<th style="text-align:left">exog</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">y</td>
<td style="text-align:left">x</td>
</tr>
<tr>
<td style="text-align:left">y variable</td>
<td style="text-align:left">x variable</td>
</tr>
<tr>
<td style="text-align:left">left hand side (LHS)</td>
<td style="text-align:left">right hand side (RHS)</td>
</tr>
<tr>
<td style="text-align:left">dependent variable（因变量）</td>
<td style="text-align:left">independent variable（自变量）</td>
</tr>
<tr>
<td style="text-align:left">regressand</td>
<td style="text-align:left">regressors</td>
</tr>
<tr>
<td style="text-align:left">outcome</td>
<td style="text-align:left">design</td>
</tr>
<tr>
<td style="text-align:left">response variable（响应变量）</td>
<td style="text-align:left">explanatory variable（解释变量）</td>
</tr>
</tbody>
</table>
<h2 id="模型和拟合结果的超类"><a class="markdownIt-Anchor" href="#模型和拟合结果的超类"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.statsmodels.org/stable/dev/internal.html#model-and-results-classes">模型和拟合结果的超类</a></h2>
<p>Model和Result是statsmodels所有模型和结果的父类</p>
<p><strong>model class</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Model(endog, exog=<span class="literal">None</span>, **kwargs) <span class="comment">#建立模型  </span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">Methods</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">fit()</td>
<td style="text-align:left">Fit a model to data.</td>
</tr>
<tr>
<td style="text-align:left">from_formula(formula, data, subset=None, drop_cols=None, *args, **kwargs)</td>
<td style="text-align:left">Create a Model from a formula and dataframe.</td>
</tr>
<tr>
<td style="text-align:left">predict(params, exog=None, *args, **kwargs)</td>
<td style="text-align:left">After a model has been fit predict returns the fitted values.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">Attributes</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">endog_names</td>
<td style="text-align:left">Names of endogenous variables</td>
</tr>
<tr>
<td style="text-align:left">exog_names</td>
<td style="text-align:left">Names of exogenous variables</td>
</tr>
</tbody>
</table>
<p><strong>result class</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Results(model, params, **kwd) <span class="comment">#一般通过模型fit方法拟合生成  </span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">Methods</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">initialize(model, params, **kwd)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">predict([exog, transform])</td>
<td style="text-align:left">Call self.model.predict with self.params as the first argument.</td>
</tr>
<tr>
<td style="text-align:left">summary()</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h1 id="回归分析"><a class="markdownIt-Anchor" href="#回归分析"></a> 回归分析</h1>
<h2 id="linear-regression线性回归"><a class="markdownIt-Anchor" href="#linear-regression线性回归"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.statsmodels.org/stable/regression.html">Linear Regression(线性回归)</a></h2>
<p><code>import statsmodels.api as sm</code><br />
适用于自变量X和因变量Y为线性关系，具体来说，画出散点图可以用一条直线来近似拟合。一般线性模型要求观测值之间相互独立、残差(因变量)服从正态分布、残差(因变量)方差齐性<br />
统计模型被假定为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Y</mi><mo>=</mo><mi>X</mi><mi>β</mi><mo>+</mo><mi>μ</mi><mo separator="true">,</mo><mi>μ</mi><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi mathvariant="normal">Σ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Y=Xβ+μ,  μ\sim N(0,Σ)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">Σ</span><span class="mclose">)</span></span></span></span></p>
<p><strong>Model Classes</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left"><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/regression.html#model-classes">Model Classes</a></th>
<th style="text-align:left">模型类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">OLS</td>
<td style="text-align:left">一个简单的普通最小二乘模型。</td>
</tr>
<tr>
<td style="text-align:left">GLS</td>
<td style="text-align:left">具有一般协方差结构的广义最小二乘模型</td>
</tr>
<tr>
<td style="text-align:left">WLS</td>
<td style="text-align:left">具有对角但非标识协方差结构的回归模型</td>
</tr>
<tr>
<td style="text-align:left">GLSAR</td>
<td style="text-align:left">具有AR（p）协方差结构的回归模型。</td>
</tr>
<tr>
<td style="text-align:left">yule_walker</td>
<td style="text-align:left">使用Yule-Walker方程从序列X估计AR（p）参数</td>
</tr>
<tr>
<td style="text-align:left">QuantReg</td>
<td style="text-align:left">分位数回归</td>
</tr>
<tr>
<td style="text-align:left">RecursiveLS</td>
<td style="text-align:left">递归最小二乘法</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">Methods</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">fit()</td>
<td style="text-align:left">Full fit of the model</td>
</tr>
<tr>
<td style="text-align:left">from_formula(<em>formula</em>, <em>data</em>)</td>
<td style="text-align:left">Create a Model from a formula and dataframe</td>
</tr>
<tr>
<td style="text-align:left">predict(<em>params</em>)</td>
<td style="text-align:left">Return linear predicted values from a design matrix.</td>
</tr>
<tr>
<td style="text-align:left">score(<em>params</em>)</td>
<td style="text-align:left">Evaluate the score function at a given point</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">Attributes</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">df_model</td>
<td style="text-align:left">模型自由度，定义为回归矩阵的秩，如果包括常数则减1</td>
</tr>
<tr>
<td style="text-align:left">df_resid</td>
<td style="text-align:left">剩余自由度，定义为观察数减去回归矩阵的rank</td>
</tr>
</tbody>
</table>
<p><strong>Results Classes</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Results Classes</th>
<th style="text-align:left">结果类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">RegressionResults</td>
<td style="text-align:left">总结了线性回归模型的拟合</td>
</tr>
<tr>
<td style="text-align:left">OLSResults</td>
<td style="text-align:left">OLS模型的结果类</td>
</tr>
<tr>
<td style="text-align:left">PredictionResults</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">QuantRegResults</td>
<td style="text-align:left">QuantReg模型的结果实例</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">Methods</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">aic(), bic(), bse()…</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">cov_params()</td>
<td style="text-align:left">返回方差/协方差矩阵</td>
</tr>
<tr>
<td style="text-align:left">eigenvals()</td>
<td style="text-align:left">返回按降序排序的特征值</td>
</tr>
<tr>
<td style="text-align:left">fvalue(), pvalues(), f_pvalue(), tvalues()</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">f_test(r_matrix), t_test()</td>
<td style="text-align:left">F检验，t检验</td>
</tr>
<tr>
<td style="text-align:left">get_prediction()</td>
<td style="text-align:left">计算预测结果</td>
</tr>
<tr>
<td style="text-align:left">save(fname), load(fname)</td>
<td style="text-align:left">保存pickle，加载（类方法）</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Load modules and data  </span></span><br><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">In [<span class="number">3</span>]: spector_data = sm.datasets.spector.load()  </span><br><span class="line">In [<span class="number">4</span>]: spector_data.exog = sm.add_constant(spector_data.exog, prepend=<span class="literal">False</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Fit and summarize OLS model  </span></span><br><span class="line">In [<span class="number">5</span>]: mod = sm.OLS(spector_data.endog, spector_data.exog)  </span><br><span class="line">In [<span class="number">6</span>]: res = mod.fit()  </span><br><span class="line">In [<span class="number">7</span>]: res.summary()  </span><br></pre></td></tr></table></figure>
<h2 id="generalized-linear广义线性回归"><a class="markdownIt-Anchor" href="#generalized-linear广义线性回归"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/glm.html#module-reference">Generalized Linear(广义线性回归)</a></h2>
<p>是为了克服线性回归模型的缺点出现的，是线性回归模型的推广。首先自变量可以是离散的，也可以是连续的。离散的可以是0-1变量，也可以是多种取值的变量。广义线性模型又取消了对残差(因变量)服从正态分布的要求。残差不一定要服从正态分布，可以服从二项、泊松、负二项、正态、伽马、逆高斯等分布，这些分布被统称为指数分布族。<br />
与线性回归模型相比较，有以下推广：</p>
<ul>
<li>随机误差项不一定服从正态分布，可以服从二项、泊松、负二项、正态、伽马、逆高斯等分布，这些分布被统称为指数分布族。</li>
<li>引入link函数<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><mo>⋅</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(\cdot )</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord">⋅</span><span class="mclose">)</span></span></span></span>。因变量和自变量通过联接函数产生影响。根据不同的数据，可以自由选择不同的模型。大家比较熟悉的Logit模型就是使用Logit联接、随机误差项服从二项分布得到模型。</li>
</ul>
<p>The statistical model for each observation  ii  is assumed to be<br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>∼</mo><msub><mi>F</mi><mrow><mi>E</mi><mi>D</mi><mi>M</mi></mrow></msub><mo stretchy="false">(</mo><mo>⋅</mo><mi mathvariant="normal">∣</mi><mi>θ</mi><mo separator="true">,</mo><mi>ϕ</mi><mo separator="true">,</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Y_i ∼F_{EDM}(⋅|θ,ϕ,w_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">⋅</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">ϕ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> and  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>μ</mi><mi>i</mi></msub><mo>=</mo><mi>E</mi><mo stretchy="false">[</mo><msub><mi>Y</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">]</mo><mo>=</mo><msup><mi>g</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><msubsup><mi>x</mi><mi>i</mi><mo mathvariant="normal">′</mo></msubsup><mi>β</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">μ_i=E[Y_i|x_i]=g^{-1}(x&#x27;_i β)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.072772em;vertical-align:-0.258664em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="mclose">)</span></span></span></span></p>
<p><strong>Model Classes</strong><br />
<code>GLM(endog, exog, family=None)</code></p>
<blockquote>
<p>Parameters:	<br />
endog (array-like)<br />
exog (array-like)<br />
family (family class instance) – The default is Gaussian</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">Methods</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">fit()</td>
<td style="text-align:left">Full fit of the model</td>
</tr>
<tr>
<td style="text-align:left">from_formula(<em>formula</em>, <em>data</em>)</td>
<td style="text-align:left">Create a Model from a formula and dataframe</td>
</tr>
<tr>
<td style="text-align:left">predict(<em>params</em>)</td>
<td style="text-align:left">Return linear predicted values from a design matrix.</td>
</tr>
<tr>
<td style="text-align:left">score(<em>params</em>)</td>
<td style="text-align:left">Evaluate the score function at a given point</td>
</tr>
</tbody>
</table>
<p><strong>Results Classes</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Results Classes</th>
<th style="text-align:left">结果类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">GLMResults</td>
<td style="text-align:left">包含GLM结果的类。</td>
</tr>
<tr>
<td style="text-align:left">PredictionResults</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<p><strong>Families</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Families</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Family(link,variances)</td>
<td style="text-align:left">单参数指数族的父类。</td>
</tr>
<tr>
<td style="text-align:left">Binomial(link=None)</td>
<td style="text-align:left">二项式指数族分布。</td>
</tr>
<tr>
<td style="text-align:left">Gamma(link=None)</td>
<td style="text-align:left">Gamma指数族分布。</td>
</tr>
<tr>
<td style="text-align:left">Gaussian(link=None)</td>
<td style="text-align:left">高斯指数族分布。</td>
</tr>
<tr>
<td style="text-align:left">InverseGaussian(link=None)</td>
<td style="text-align:left">InverseGaussian指数族。</td>
</tr>
<tr>
<td style="text-align:left">NegativeBinomial(link=None,alpha=None)</td>
<td style="text-align:left">负二项指数族。</td>
</tr>
<tr>
<td style="text-align:left">Poisson(link=None)</td>
<td style="text-align:left">泊松指数族。</td>
</tr>
<tr>
<td style="text-align:left">Tweedie(link=None,var_power=None)</td>
<td style="text-align:left">Tweedie。</td>
</tr>
</tbody>
</table>
<p><strong>Link Functions</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sm.families.family.&lt;familyname&gt;.links  </span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">Link Functions</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Link</td>
<td style="text-align:left">单参数指数族的通用链接函数。</td>
</tr>
<tr>
<td style="text-align:left">CDFLink([DBN])</td>
<td style="text-align:left">使用scipy.stats发行版的CDF</td>
</tr>
<tr>
<td style="text-align:left">CLogLog</td>
<td style="text-align:left">互补的log-log变换</td>
</tr>
<tr>
<td style="text-align:left">Log</td>
<td style="text-align:left">对数转换</td>
</tr>
<tr>
<td style="text-align:left">Logit</td>
<td style="text-align:left">logit变换</td>
</tr>
<tr>
<td style="text-align:left">NegativeBinomial([α])</td>
<td style="text-align:left">负二项式link函数</td>
</tr>
<tr>
<td style="text-align:left">Power([power])</td>
<td style="text-align:left">指数转换</td>
</tr>
<tr>
<td style="text-align:left">cauchy()</td>
<td style="text-align:left">Cauchy(标准Cauchy CDF)变换</td>
</tr>
<tr>
<td style="text-align:left">cloglog</td>
<td style="text-align:left">CLogLog转换link函数。</td>
</tr>
<tr>
<td style="text-align:left">identity()</td>
<td style="text-align:left">identity转换</td>
</tr>
<tr>
<td style="text-align:left">inverse_power()</td>
<td style="text-align:left">逆变换</td>
</tr>
<tr>
<td style="text-align:left">inverse_squared()</td>
<td style="text-align:left">逆平方变换</td>
</tr>
<tr>
<td style="text-align:left">nbinom([α])</td>
<td style="text-align:left">负二项式link函数。</td>
</tr>
<tr>
<td style="text-align:left">probit([DBN])</td>
<td style="text-align:left">probit(标准普通CDF)变换</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">In [<span class="number">2</span>]: data = sm.datasets.scotland.load()  </span><br><span class="line">In [<span class="number">3</span>]: data.exog = sm.add_constant(data.exog)  </span><br><span class="line"><span class="comment"># Instantiate a gamma family model with the default link function.  </span></span><br><span class="line">In [<span class="number">4</span>]: gamma_model = sm.GLM(data.endog, data.exog, family=sm.families.Gamma())  </span><br><span class="line">In [<span class="number">5</span>]: gamma_results = gamma_model.fit()  </span><br><span class="line">In [<span class="number">6</span>]: <span class="built_in">print</span>(gamma_results.summary())  </span><br><span class="line">In [<span class="number">7</span>]: gamma_results = gamma_model.fit()  </span><br><span class="line">In [<span class="number">8</span>]: gamma_results.params  </span><br></pre></td></tr></table></figure>
<h2 id="generalized-estimating-equations广义估计方程"><a class="markdownIt-Anchor" href="#generalized-estimating-equations广义估计方程"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/gee.html">Generalized Estimating Equations(广义估计方程)</a></h2>
<p>实际工作中一些资料由于部分观察值含有非独立或相关的信息，不能用传统的一般线性（或广义线性进行分析），故而发展出了广义估计方程。如纵向数据，重复测量数据，整群抽样设计资料，聚集性资料或是多次层次系统结构资料。</p>
<blockquote>
<p>纵向数据(longitudinal data)：是按照时间顺序对个体某指标进行重复测量得到的数据，同一对象的多次测量成相关性（倾向），如儿童的生长检测资料</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">Model Classes</th>
<th style="text-align:left">模型类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">GEE</td>
<td style="text-align:left">用广义估计方程（GEE）估计边际回归模型。</td>
</tr>
<tr>
<td style="text-align:left"><strong>Results Classes</strong></td>
<td style="text-align:left">结果类</td>
</tr>
<tr>
<td style="text-align:left">GEEResults</td>
<td style="text-align:left">总结了使用GEE的边际回归模型的适合性。</td>
</tr>
<tr>
<td style="text-align:left">GEEMargins</td>
<td style="text-align:left">与GEE匹配的回归模型的估计边际效应。</td>
</tr>
<tr>
<td style="text-align:left"><strong>Dependence Structures</strong></td>
<td style="text-align:left">依赖结构</td>
</tr>
<tr>
<td style="text-align:left">CovStruct</td>
<td style="text-align:left">分组数据的相关性和协方差结构的基类。</td>
</tr>
<tr>
<td style="text-align:left">Autoregressive</td>
<td style="text-align:left">一阶自回归工作依赖结构。</td>
</tr>
<tr>
<td style="text-align:left">Exchangeable</td>
<td style="text-align:left">可交换的工作依赖结构。</td>
</tr>
<tr>
<td style="text-align:left">GlobalOddsRatio</td>
<td style="text-align:left">估算具有序数或名义数据的GEE的全局优势比。</td>
</tr>
<tr>
<td style="text-align:left">Independence</td>
<td style="text-align:left">独立工作依赖结构。</td>
</tr>
<tr>
<td style="text-align:left">Nested</td>
<td style="text-align:left">嵌套的工作相关结构。</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> statsmodels.formula.api <span class="keyword">as</span> smf  </span><br><span class="line">In [<span class="number">3</span>]: data = sm.datasets.get_rdataset(<span class="string">&#x27;epil&#x27;</span>, package=<span class="string">&#x27;MASS&#x27;</span>).data  </span><br><span class="line">In [<span class="number">4</span>]: fam = sm.families.Poisson()  </span><br><span class="line">In [<span class="number">5</span>]: ind = sm.cov_struct.Exchangeable()  </span><br><span class="line">In [<span class="number">6</span>]: mod = smf.gee(<span class="string">&quot;y ~ age + trt + base&quot;</span>, <span class="string">&quot;subject&quot;</span>, data,  </span><br><span class="line">   ...:               cov_struct=ind, family=fam)  </span><br><span class="line">In [<span class="number">7</span>]: res = mod.fit()  </span><br><span class="line">In [<span class="number">8</span>]: <span class="built_in">print</span>(res.summary())  </span><br></pre></td></tr></table></figure>
<h2 id="robust-linear-models稳健的线性模型"><a class="markdownIt-Anchor" href="#robust-linear-models稳健的线性模型"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/rlm.html">Robust Linear Models(稳健的线性模型)</a></h2>
<p>稳健回归(robust regression)是将稳健估计方法用于回归模型，以拟合大部分数据存在的结构，同时可识别出潜在可能的离群点、强影响点或与模型假设相偏离的结构。当误差服从正态分布时，其估计几乎和最小二乘估计一样好，而最小二乘估计条件不满足时，其结果优于最小二乘估计。</p>
<table>
<thead>
<tr>
<th style="text-align:left">Model Classes</th>
<th style="text-align:left">模型类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">RLM</td>
<td style="text-align:left">稳健的线性模型</td>
</tr>
<tr>
<td style="text-align:left"><strong>Results Classes</strong></td>
<td style="text-align:left">结果类</td>
</tr>
<tr>
<td style="text-align:left">RLMResults</td>
<td style="text-align:left">包含RLM结果的类</td>
</tr>
<tr>
<td style="text-align:left"><strong>Norms</strong></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">AndrewWave</td>
<td style="text-align:left">安德鲁的M估计浪潮。</td>
</tr>
<tr>
<td style="text-align:left">Hampe</td>
<td style="text-align:left">Hampel函数用于M估计。</td>
</tr>
<tr>
<td style="text-align:left">HuberT</td>
<td style="text-align:left">胡伯的T为M估计。</td>
</tr>
<tr>
<td style="text-align:left">LeastSquares</td>
<td style="text-align:left">M估计的最小二乘ρ及其派生函数。</td>
</tr>
<tr>
<td style="text-align:left">RamsayE</td>
<td style="text-align:left">Ramsay的Ea用于M估计。</td>
</tr>
<tr>
<td style="text-align:left">RobustNorm</td>
<td style="text-align:left">用于稳健回归的规范的父类。</td>
</tr>
<tr>
<td style="text-align:left">TrimmedMean</td>
<td style="text-align:left">用于M估计的修正均值函数。</td>
</tr>
<tr>
<td style="text-align:left">TukeyBiweight</td>
<td style="text-align:left">Tukey的M估计的权重函数。</td>
</tr>
<tr>
<td style="text-align:left">estimate_location</td>
<td style="text-align:left">使用self.norm和当前的尺度估计量的位置M估计量。</td>
</tr>
<tr>
<td style="text-align:left"><strong>Scale</strong></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Huber</td>
<td style="text-align:left">Huber提出的联合估计地点和规模的建议2。</td>
</tr>
<tr>
<td style="text-align:left">HuberScale</td>
<td style="text-align:left">Huber用于拟合鲁棒线性模型的缩放比例。</td>
</tr>
<tr>
<td style="text-align:left">mad</td>
<td style="text-align:left">沿数组给定轴的中值绝对偏差</td>
</tr>
<tr>
<td style="text-align:left">hubers_scale</td>
<td style="text-align:left">Huber用于拟合鲁棒线性模型的缩放比例。</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Load modules and data  </span></span><br><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">In [<span class="number">2</span>]: data = sm.datasets.stackloss.load()  </span><br><span class="line">In [<span class="number">3</span>]: data.exog = sm.add_constant(data.exog)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Fit model and print summary  </span></span><br><span class="line">In [<span class="number">4</span>]: rlm_model = sm.RLM(data.endog, data.exog,M=sm.robust.norms.HuberT())  </span><br><span class="line">In [<span class="number">5</span>]: rlm_results = rlm_model.fit()  </span><br><span class="line">In [<span class="number">6</span>]: <span class="built_in">print</span>(rlm_results.params)  </span><br><span class="line">[-<span class="number">41.0265</span>   <span class="number">0.8294</span>   <span class="number">0.9261</span>  -<span class="number">0.1278</span>]  </span><br></pre></td></tr></table></figure>
<h2 id="linear-mixed-effects-models线性混合效应模型"><a class="markdownIt-Anchor" href="#linear-mixed-effects-models线性混合效应模型"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/mixed_linear.html">Linear Mixed Effects Models(线性混合效应模型)</a></h2>
<p>参考链接：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/sinat_26917383/article/details/51636011">https://blog.csdn.net/sinat_26917383/article/details/51636011</a></p>
<p>在线性模型中加入随机效应项，消了观测值之间相互独立和残差(因变量)方差齐性的要求。</p>
<table>
<thead>
<tr>
<th style="text-align:left">Model Classes</th>
<th style="text-align:left">模型类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MixedLM</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left"><strong>Results Classes</strong></td>
<td style="text-align:left">结果类</td>
</tr>
<tr>
<td style="text-align:left">MixedLMResults</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> statsmodels.formula.api <span class="keyword">as</span> smf  </span><br><span class="line">In [<span class="number">3</span>]: data = sm.datasets.get_rdataset(<span class="string">&quot;dietox&quot;</span>, <span class="string">&quot;geepack&quot;</span>).data  </span><br><span class="line">In [<span class="number">4</span>]: md = smf.mixedlm(<span class="string">&quot;Weight ~ Time&quot;</span>, data, groups=data[<span class="string">&quot;Pig&quot;</span>])  </span><br><span class="line">In [<span class="number">5</span>]: mdf = md.fit()  </span><br><span class="line">In [<span class="number">6</span>]: <span class="built_in">print</span>(mdf.summary())  </span><br></pre></td></tr></table></figure>
<h2 id="regression-with-discrete-dependent-variable离散因变量回归"><a class="markdownIt-Anchor" href="#regression-with-discrete-dependent-variable离散因变量回归"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/discretemod.html">Regression with Discrete Dependent Variable(离散因变量回归)</a></h2>
<table>
<thead>
<tr>
<th style="text-align:left">Model Classes</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Logit(endog,exog,**kwargs)</td>
<td style="text-align:left">二元logit模型</td>
</tr>
<tr>
<td style="text-align:left">Probit(endog,exog,**kwargs)</td>
<td style="text-align:left">二元Probit模型</td>
</tr>
<tr>
<td style="text-align:left">MNLogit(endog,exog,**kwargs)</td>
<td style="text-align:left">多项logit模型</td>
</tr>
<tr>
<td style="text-align:left">Poisson(endog, exog[, offset, exposure, missing])</td>
<td style="text-align:left">计数数据的泊松模型</td>
</tr>
<tr>
<td style="text-align:left">NegativeBinomial(endog,exog [,…])</td>
<td style="text-align:left">计数数据的负二项模型</td>
</tr>
<tr>
<td style="text-align:left">NegativeBinomialP(endog,exog [,p,offset,…])</td>
<td style="text-align:left">计数数据的广义负二项(NB-P)模型</td>
</tr>
<tr>
<td style="text-align:left">GeneralizedPoisson(endog,exog [,p,offset,…])</td>
<td style="text-align:left">计数数据的广义Poisson模型</td>
</tr>
<tr>
<td style="text-align:left">ZeroInflatedPoisson(endog,exog [,…])</td>
<td style="text-align:left">用于计数数据的泊松零膨胀模型</td>
</tr>
<tr>
<td style="text-align:left">ZeroInflatedNegativeBinomialP(endog,exog [,…])</td>
<td style="text-align:left">计数数据的零膨胀广义负二项模型</td>
</tr>
<tr>
<td style="text-align:left">ZeroInflatedGeneralizedPoisson(endog,exog)</td>
<td style="text-align:left">计数数据的零膨胀广义Poisson模型</td>
</tr>
<tr>
<td style="text-align:left"><strong>Results Classes</strong></td>
<td style="text-align:left">结果类</td>
</tr>
<tr>
<td style="text-align:left">LogitResults（model，mlefit [，cov_type，…]）</td>
<td style="text-align:left">Logit Model的结果类</td>
</tr>
<tr>
<td style="text-align:left">ProbitResults（model，mlefit [，cov_type，…]）</td>
<td style="text-align:left">Probit模型的结果类</td>
</tr>
<tr>
<td style="text-align:left">CountResults（model，mlefit [，cov_type，…]）</td>
<td style="text-align:left">计数数据的结果类</td>
</tr>
<tr>
<td style="text-align:left">MultinomialResults（model，mlefit [，…]）</td>
<td style="text-align:left">多项数据的结果类</td>
</tr>
<tr>
<td style="text-align:left">NegativeBinomialResults（model，mlefit [，…]）</td>
<td style="text-align:left">NegativeBinomial 1和2的结果类</td>
</tr>
<tr>
<td style="text-align:left">GeneralizedPoissonResults（model，mlefit [，…]）</td>
<td style="text-align:left">广义泊松分析的结果类</td>
</tr>
<tr>
<td style="text-align:left">ZeroInflatedPoissonResults（model，mlefit [，…]）</td>
<td style="text-align:left">零膨胀泊松的结果类</td>
</tr>
<tr>
<td style="text-align:left">ZeroInflatedNegativeBinomialResults</td>
<td style="text-align:left">零膨胀一般化负二项式的结果类</td>
</tr>
<tr>
<td style="text-align:left">ZeroInflatedGeneralizedPoissonResults</td>
<td style="text-align:left">零膨胀广义泊松的结果类</td>
</tr>
</tbody>
</table>
<p>DiscreteModel是所有离散回归模型的超类。估算结果作为其中一个子类的实例返回 DiscreteResults。模型的每个类别（二进制，计数和多项）都有其自己的中级模型和结果类。这个中间类主要是为了方便实现由DiscreteModel和 定义的方法和属性DiscreteResults。</p>
<table>
<thead>
<tr>
<th style="text-align:left">DiscreteModel（endog，exog，** kwargs）</th>
<th style="text-align:left">抽象类用于离散选择模型。</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">DiscreteResults（model，mlefit [，cov_type，…]）</td>
<td style="text-align:left">离散因变量模型的结果类。</td>
</tr>
<tr>
<td style="text-align:left">BinaryModel（endog，exog，** kwargs）</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">BinaryResults（model，mlefit [，cov_type，…]）</td>
<td style="text-align:left">二进制数据的结果类</td>
</tr>
<tr>
<td style="text-align:left">CountModel（endog，exog [，offset，exposure，…]）</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">MultinomialModel（endog，exog，** kwargs）</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">GenericZeroInflated（endog，exog [，…]）</td>
<td style="text-align:left">Generiz Zero计数数据的充气模型</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Load the data from Spector and Mazzeo (1980)  </span></span><br><span class="line">In [<span class="number">1</span>]: spector_data = sm.datasets.spector.load()  </span><br><span class="line">In [<span class="number">2</span>]: spector_data.exog = sm.add_constant(spector_data.exog)  </span><br><span class="line"><span class="comment"># Logit Model  </span></span><br><span class="line">In [<span class="number">3</span>]: logit_mod = sm.Logit(spector_data.endog, spector_data.exog)  </span><br><span class="line">In [<span class="number">4</span>]: logit_res = logit_mod.fit()  </span><br><span class="line">Optimization terminated successfully.  </span><br><span class="line"> Current function value: <span class="number">0.402801</span>  </span><br><span class="line"> Iterations <span class="number">7</span>  </span><br><span class="line">In [<span class="number">5</span>]: <span class="built_in">print</span>(logit_res.summary())  </span><br></pre></td></tr></table></figure>
<h2 id="generalized-linear-mixed-effects-models广义线性混合效应模型"><a class="markdownIt-Anchor" href="#generalized-linear-mixed-effects-models广义线性混合效应模型"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/mixed_glm.html">Generalized Linear Mixed Effects Models(广义线性混合效应模型)</a></h2>
<p>广义线性混合效应模型是混合效应模型的推广</p>
<table>
<thead>
<tr>
<th style="text-align:left">Model Classes</th>
<th style="text-align:left">模型类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">BinomialBayesMixedGLM</td>
<td style="text-align:left">用贝叶斯方法拟合广义线性混合模型。</td>
</tr>
<tr>
<td style="text-align:left">PoissonBayesMixedGLM</td>
<td style="text-align:left">用贝叶斯方法拟合广义线性混合模型。</td>
</tr>
<tr>
<td style="text-align:left"><strong>Results Classes</strong></td>
<td style="text-align:left">结果类</td>
</tr>
<tr>
<td style="text-align:left">BayesMixedGLMResults</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h2 id="方差分析"><a class="markdownIt-Anchor" href="#方差分析"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/anova.html">方差分析</a></h2>
<p>方差分析(Analysis of Variance，简称ANOVA)，又称“变异数分析”，为数据分析中常见的统计模型，主要为探讨连续型（Continuous）因变量（Dependent variable）与类别型自变量（Independent variable）的关系。当自变量的因子等于或超过三个类别时，检验各类别平均值是否相等，采用方差分析。<br />
广义t检验中，方差相等（Equality of variance）的合并t检验（Pooled T-test）视为是方差分析的一种。t检验分析两组平均数是否相等，方差分析也采用相同的计算概念，实际上，当方差分析套用在合并t检验的分析上时，产生的F值则会等于t检验的平方项。</p>
<p>总偏差平方和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>S</mi><mi>t</mi><mo>=</mo><mi>S</mi><mi>S</mi><mi>b</mi><mo>+</mo><mi>S</mi><mi>S</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">SSt = SSb + SSw</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span></p>
<p>statsmodels包含anova_lm模型，用于使用线性OLSModel进行方差分析，和AnovaRM模型，用于重复测量方差分析（包含平衡数据方差分析）。</p>
<table>
<thead>
<tr>
<th style="text-align:left">Module Reference</th>
<th style="text-align:left">desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>anova_lm(*args, **kwargs)</code></td>
<td style="text-align:left">Anova table for one or more fitted linear models</td>
</tr>
<tr>
<td style="text-align:left"><code>AnovaRM(data, depvar, subject[, within, …])</code></td>
<td style="text-align:left">Repeated measures Anova using least squares regression</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">In [<span class="number">2</span>]: <span class="keyword">from</span> statsmodels.formula.api <span class="keyword">import</span> ols  </span><br><span class="line">In [<span class="number">3</span>]: moore = sm.datasets.get_rdataset(<span class="string">&quot;Moore&quot;</span>, <span class="string">&quot;car&quot;</span>,  </span><br><span class="line">   ...:                                  cache=<span class="literal">True</span>) <span class="comment"># load data  </span></span><br><span class="line">In [<span class="number">4</span>]: data = moore.data  </span><br><span class="line">In [<span class="number">5</span>]: data = data.rename(columns=&#123;<span class="string">&quot;partner.status&quot;</span>:  </span><br><span class="line">   ...:                             <span class="string">&quot;partner_status&quot;</span>&#125;) <span class="comment"># make name pythonic  </span></span><br><span class="line">In [<span class="number">6</span>]: moore_lm = ols(<span class="string">&#x27;conformity ~ C(fcategory, Sum)*C(partner_status, Sum)&#x27;</span>,  </span><br><span class="line">   ...:                 data=data).fit()  </span><br><span class="line">In [<span class="number">7</span>]: table = sm.stats.anova_lm(moore_lm, typ=<span class="number">2</span>) <span class="comment"># Type 2 ANOVA DataFrame  </span></span><br><span class="line">In [<span class="number">8</span>]: <span class="built_in">print</span>(table)  </span><br><span class="line">                                              sum_sq    df          F  \  </span><br><span class="line">C(fcategory, Sum)                          <span class="number">11.614700</span>   <span class="number">2.0</span>   <span class="number">0.276958</span>     </span><br><span class="line">C(partner_status, Sum)                    <span class="number">212.213778</span>   <span class="number">1.0</span>  <span class="number">10.120692</span>     </span><br><span class="line">C(fcategory, Sum):C(partner_status, Sum)  <span class="number">175.488928</span>   <span class="number">2.0</span>   <span class="number">4.184623</span>     </span><br><span class="line">Residual                                  <span class="number">817.763961</span>  <span class="number">39.0</span>        NaN     </span><br><span class="line">  </span><br><span class="line">                                            PR(&gt;F)    </span><br><span class="line">C(fcategory, Sum)                         <span class="number">0.759564</span>    </span><br><span class="line">C(partner_status, Sum)                    <span class="number">0.002874</span>    </span><br><span class="line">C(fcategory, Sum):C(partner_status, Sum)  <span class="number">0.022572</span>    </span><br><span class="line">Residual                                       NaN    </span><br></pre></td></tr></table></figure>
<h1 id="时间序列分析"><a class="markdownIt-Anchor" href="#时间序列分析"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/tsa.html">时间序列分析</a></h1>
<p>时间序列分析是根据系统观测得到的时间序列数据，通过曲线拟合和参数估计来建立数学模型的理论和方法。它一般采用曲线拟合和参数估计方法（如非线性最小二乘法）进行。时间序列分析常用在国民经济宏观控制、区域综合发展规划、企业经营管理、市场潜量预测、气象预报、水文预报、地震前兆预报、农作物病虫灾害预报、环境污染控制、生态平衡、天文学和海洋学等方面。</p>
<p>参考链接：<br />
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/u010414589/article/details/49622625">python时间序列分析之ARIMA</a><br />
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.jianshu.com/p/cced6617b423">AR(I)MA时间序列建模过程——步骤和python代码</a><br />
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.ziiai.com/blog/638">https://www.ziiai.com/blog/638</a><br />
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.analyticsvidhya.com/blog/2015/12/complete-tutorial-time-series-modeling/">https://www.analyticsvidhya.com/blog/2015/12/complete-tutorial-time-series-modeling/</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> statsmodels <span class="keyword">import</span> tsa  </span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">子模块</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">stattools</td>
<td style="text-align:left">经验属性和测试，acf，pacf，granger-causality，adf单位根测试，kpss测试，bds测试，ljung-box测试等。</td>
</tr>
<tr>
<td style="text-align:left">ar_model</td>
<td style="text-align:left">单变量自回归过程，使用条件和精确最大似然估计和条件最小二乘</td>
</tr>
<tr>
<td style="text-align:left">arima_mode</td>
<td style="text-align:left">单变量ARMA过程，使用条件和精确最大似然估计和条件最小二乘法</td>
</tr>
<tr>
<td style="text-align:left">vector_ar，var</td>
<td style="text-align:left">向量自回归过程（VAR）估计模型，脉冲响应分析，预测误差方差分解和数据可视化工具</td>
</tr>
<tr>
<td style="text-align:left">kalmanf</td>
<td style="text-align:left">使用卡尔曼滤波器的ARMA和其他具有精确MLE的模型的估计类</td>
</tr>
<tr>
<td style="text-align:left">arma_process</td>
<td style="text-align:left">具有给定参数的arma进程的属性，包括在ARMA，MA和AR表示之间进行转换的工具以及acf，pacf，频谱密度，脉冲响应函数和类似</td>
</tr>
<tr>
<td style="text-align:left">sandbox.tsa.fftarma</td>
<td style="text-align:left">类似于arma_process但在频域工作</td>
</tr>
<tr>
<td style="text-align:left">tsatools</td>
<td style="text-align:left">额外的辅助函数，用于创建滞后变量数组，构造趋势，趋势和类似的回归量。</td>
</tr>
<tr>
<td style="text-align:left">filters</td>
<td style="text-align:left">过滤时间序列的辅助函数</td>
</tr>
<tr>
<td style="text-align:left">regime_switching</td>
<td style="text-align:left">马尔可夫切换动态回归和自回归模型</td>
</tr>
</tbody>
</table>
<h2 id="时间序列模型"><a class="markdownIt-Anchor" href="#时间序列模型"></a> 时间序列模型</h2>
<h3 id="常用模型"><a class="markdownIt-Anchor" href="#常用模型"></a> 常用模型</h3>
<p>常用的时间序列模型有四种：自回归模型 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>R</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">AR(p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span>、移动平均模型 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>A</mi><mo stretchy="false">(</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">MA(q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>、自回归移动平均模型 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>R</mi><mi>M</mi><mi>A</mi><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ARMA(p,q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>、自回归差分移动平均模型 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>R</mi><mi>I</mi><mi>M</mi><mi>A</mi><mo stretchy="false">(</mo><mi>p</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ARIMA(p,d,q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span><br />
<strong>ARMA模型</strong><br />
自回归滑动平均模型（英语：Autoregressive moving average model，简称：ARMA模型）。是研究时间序列的重要方法，由自回归模型（简称AR模型）与移动平均模型（简称MA模型）为基础“混合”构成。<br />
基本原理：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Y</mi><mi>t</mi></msub><mo>=</mo><msub><mi>β</mi><mn>1</mn></msub><msub><mi>Y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>β</mi><mn>2</mn></msub><msub><mi>Y</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>⋯</mo><mo>+</mo><msub><mi>β</mi><mi>p</mi></msub><msub><mi>Y</mi><mrow><mi>t</mi><mo>−</mo><mi>p</mi></mrow></msub><mo>+</mo><msub><mi>Z</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">Y_t=\beta_1Y_{t-1}+\beta_2Y_{t-2}+..\cdots+\beta_pY_{t-p}+Z_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28055599999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><br />
误差项：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Z</mi><mi>t</mi></msub><mo>=</mo><msub><mi>ε</mi><mi>t</mi></msub><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><msub><mi>ε</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>α</mi><mn>2</mn></msub><msub><mi>ε</mi><mrow><mi>t</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>α</mi><mi>q</mi></msub><msub><mi>ε</mi><mrow><mi>t</mi><mo>−</mo><mi>q</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_t=\varepsilon_t+\alpha_1\varepsilon_{t-1}+\alpha_2\varepsilon_{t-2}+\cdots+\alpha_q\varepsilon_{t-q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.791661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">ε</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28055599999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><br />
<strong>ARIMA模型</strong><br />
ARIMA模型（英语：AutoregressiveIntegratedMovingAverage model），差分整合移动平均自回归模型，又称整合移动平均自回归模型（移动也可称作滑动），时间序列预测分析方法之一。ARIMA（p，d，q）中，AR是&quot;自回归&quot;，p为自回归项数；MA为&quot;滑动平均&quot;，q为滑动平均项数，d为使之成为平稳序列所做的差分次数（阶数）。<br />
当时间序列本身不是平稳的时候，如果它的增量，即一次差分，稳定在零点附近，可以将看成是平稳序列。在实际的问题中，所遇到的多数非平稳序列可以通过一次或多次差分后成为平稳时间序列，则可以建立模型。</p>
<h3 id="arima模型运用的流程"><a class="markdownIt-Anchor" href="#arima模型运用的流程"></a> ARIMA模型运用的流程</h3>
<ol>
<li>根据时间序列的散点图、自相关函数和偏自相关函数图识别其平稳性。</li>
<li>对非平稳的时间序列数据进行平稳化处理。直到处理后的自相关函数和偏自相关函数的数值非显著非零。</li>
<li>根据所识别出来的特征建立相应的时间序列模型。平稳化处理后，若偏自相关函数是截尾的，而自相关函数是拖尾的，则建立AR模型；若偏自相关函数是拖尾的，而自相关函数是截尾的，则建立MA模型；若偏自相关函数和自相关函数均是拖尾的，则序列适合ARMA模型。</li>
<li>参数估计，检验是否具有统计意义。</li>
<li>假设检验，判断（诊断）残差序列是否为白噪声序列。</li>
<li>利用已通过检验的模型进行预测</li>
</ol>
<h3 id="arma-example-sunspots-data"><a class="markdownIt-Anchor" href="#arma-example-sunspots-data"></a> ARMA example: Sunspots data</h3>
<p><strong>导入数据并作图</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function  </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> stats  </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd  </span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line"><span class="keyword">from</span> statsmodels.graphics.api <span class="keyword">import</span> qqplot  </span><br><span class="line">  </span><br><span class="line">dta = sm.datasets.sunspots.load_pandas().data  </span><br><span class="line">dta.index = pd.Index(sm.tsa.datetools.dates_from_range(<span class="string">&#x27;1700&#x27;</span>, <span class="string">&#x27;2008&#x27;</span>))  </span><br><span class="line"><span class="keyword">del</span> dta[<span class="string">&quot;YEAR&quot;</span>]  </span><br><span class="line">dta.plot(figsize=(<span class="number">12</span>,<span class="number">8</span>))  </span><br><span class="line">plt.show()  </span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/sunpots.png"  style="zoom:75%;" />  
<p><strong>参数估计</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))  </span><br><span class="line">ax1 = fig.add_subplot(<span class="number">211</span>)  </span><br><span class="line">fig = sm.graphics.tsa.plot_acf(dta.values.squeeze(), lags=<span class="number">40</span>, ax=ax1)  </span><br><span class="line">ax2 = fig.add_subplot(<span class="number">212</span>)  </span><br><span class="line">fig = sm.graphics.tsa.plot_pacf(dta, lags=<span class="number">40</span>, ax=ax2)  </span><br></pre></td></tr></table></figure>
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/acf.png" alt="sunpots" width="75%" />
<p><strong>拟合模型并评估</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>arma_mod20 = sm.tsa.ARMA(dta, (<span class="number">2</span>,<span class="number">0</span>)).fit(disp=<span class="literal">False</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(arma_mod20.params)  </span><br><span class="line">const                <span class="number">49.659542</span>  </span><br><span class="line">ar.L1.SUNACTIVITY     <span class="number">1.390656</span>  </span><br><span class="line">ar.L2.SUNACTIVITY    -<span class="number">0.688571</span>  </span><br><span class="line">dtype: float64  </span><br><span class="line">/Users/taugspurger/sandbox/statsmodels/statsmodels/tsa/base/tsa_model.py:<span class="number">171</span>: ValueWarning: No frequency information was provided, so inferred frequency A-DEC will be used.  </span><br><span class="line">  % freq, ValueWarning)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>arma_mod30 = sm.tsa.ARMA(dta, (<span class="number">3</span>,<span class="number">0</span>)).fit(disp=<span class="literal">False</span>)  </span><br><span class="line">/Users/taugspurger/sandbox/statsmodels/statsmodels/tsa/base/tsa_model.py:<span class="number">171</span>: ValueWarning: No frequency information was provided, so inferred frequency A-DEC will be used.  </span><br><span class="line">  % freq, ValueWarning)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(arma_mod20.aic, arma_mod20.bic, arma_mod20.hqic)  </span><br><span class="line"><span class="number">2622.636338065809</span> <span class="number">2637.5697031734</span> <span class="number">2628.606725911055</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(arma_mod30.params)  </span><br><span class="line">const                <span class="number">49.749936</span>  </span><br><span class="line">ar.L1.SUNACTIVITY     <span class="number">1.300810</span>  </span><br><span class="line">ar.L2.SUNACTIVITY    -<span class="number">0.508093</span>  </span><br><span class="line">ar.L3.SUNACTIVITY    -<span class="number">0.129650</span>  </span><br><span class="line">dtype: float64  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(arma_mod30.aic, arma_mod30.bic, arma_mod30.hqic)  </span><br><span class="line"><span class="number">2619.4036286964474</span> <span class="number">2638.0703350809363</span> <span class="number">2626.866613503005</span>  </span><br></pre></td></tr></table></figure>
<p><strong>假设检验</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sm.stats.durbin_watson(arma_mod30.resid.values) <span class="comment">#D-W检验  </span></span><br><span class="line"><span class="number">1.9564807635787604</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fig = plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax = fig.add_subplot(<span class="number">111</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax = arma_mod30.resid.plot(ax=ax) <span class="comment">#残差正态  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>resid = arma_mod30.resid  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stats.normaltest(resid)  </span><br><span class="line">NormaltestResult(statistic=<span class="number">49.845019661107585</span>, pvalue=<span class="number">1.5006917858823576e-11</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fig = plt.figure(figsize=(<span class="number">12</span>,<span class="number">8</span>))  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax = fig.add_subplot(<span class="number">111</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fig = qqplot(resid, line=<span class="string">&#x27;q&#x27;</span>, ax=ax, fit=<span class="literal">True</span>)  </span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/arma.png" width="50%" height="50%" />  
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/qq.png" alt="qq" width="50%" height="50%"/>  
<p><strong>模型预测</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">predict_sunspots = arma_mod30.predict(<span class="string">&#x27;1990&#x27;</span>, <span class="string">&#x27;2012&#x27;</span>, dynamic=<span class="literal">True</span>)  </span><br><span class="line">fig, ax = plt.subplots(figsize=(<span class="number">12</span>, <span class="number">8</span>))  </span><br><span class="line">ax = dta.loc[<span class="string">&#x27;1950&#x27;</span>:].plot(ax=ax)  </span><br><span class="line">fig = arma_mod30.plot_predict(<span class="string">&#x27;1990&#x27;</span>, <span class="string">&#x27;2012&#x27;</span>, dynamic=<span class="literal">True</span>, ax=ax, plot_insample=<span class="literal">False</span>)  </span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/pre.png" style="zoom:67%;" />  
<h2 id="状态空间方法"><a class="markdownIt-Anchor" href="#状态空间方法"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/statespace.html">状态空间方法</a></h2>
<p><code>statsmodels.tsa.statespace</code></p>
<h3 id="模型意义"><a class="markdownIt-Anchor" href="#模型意义"></a> 模型意义</h3>
<p>状态空间模型起源于平稳时间序列分析。当用于非平稳时间序列分析时需要将非平稳时间序列分解为随机游走成分(趋势)和弱平稳成分两个部分分别建模。 含有随机游走成分的时间序列又称积分时间序列，因为随机游走成分是弱平稳成分的和或积分。当一个向量值积分序列中的某些序列的线性组合变成弱平稳时就称这些序列构成了协调积分(cointegrated)过程。 非平稳时间序列的线性组合可能产生平稳时间序列这一思想可以追溯到回归分析，Granger提出的协调积分概念使这一思想得到了科学的论证。 Aoki和Cochrane等人的研究表明：很多非平稳多变量时间序列中的随机游走成分比以前人们认为的要小得多，有时甚至完全消失。<a target="_blank" rel="noopener external nofollow noreferrer" href="https://baike.baidu.com/item/%E7%8A%B6%E6%80%81%E7%A9%BA%E9%97%B4%E6%A8%A1%E5%9E%8B/5096878"><em>百度百科</em></a></p>
<h3 id="状态空间模型的建立和预测的步骤"><a class="markdownIt-Anchor" href="#状态空间模型的建立和预测的步骤"></a> 状态空间模型的建立和预测的步骤</h3>
<p>为了避免由于状态空间模型的不可控制性而导致的错误的分解形式，当对一个单整时间序列建立状态空间分解模型并进行预测，应按下面的步骤执行：<br />
(1) 对相关的时间序列进行季节调整，并将季节要素序列外推；<br />
(2) 对季节调整后的时间序列进行单位根检验，确定单整阶数，然后在ARIMA过程中选择最接近的模型；<br />
(3) 求出ARIMA模型的系数；<br />
(4) 用ARIMA模型的系数准确表示正规状态空间模型，检验状态空间模型的可控制性；<br />
(5) 利用Kalman滤波公式估计状态向量，并对时间序列进行预测。<br />
(6) 把外推的季节要素与相应的预测值合并，就得到经济时间序列的预测结果</p>
<h2 id="矢量自回归"><a class="markdownIt-Anchor" href="#矢量自回归"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/vector_ar.htmls">矢量自回归</a></h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> statsmodels.tsa.api <span class="keyword">import</span> VAR  </span><br></pre></td></tr></table></figure>
<p>向量自回归（VAR）是基于数据的统计性质建立模型，VAR模型把系统中每一个内生变量作为系统中所有内生变量的滞后值的函数来构造模型，从而将单变量自回归模型推广到由多元时间序列变量组成的“向量”自回归模型。VAR模型是处理多个相关经济指标的分析与预测最容易操作的模型之一，并且在一定的条件下，多元MA和ARMA模型也可转化成VAR模型，因此近年来VAR模型受到越来越多的经济工作者的重视。</p>
<h3 id="var进程var-processes"><a class="markdownIt-Anchor" href="#var进程var-processes"></a> VAR进程(VAR processes)</h3>
<p>VAR(p)建立<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>×</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">T \times K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span></span></span></span>多变量时间序列Y，T为观测数量，K为变量数量。<br />
估计时间序列与其滞后值之间关系的向量自回归过程为：<br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Y</mi><mi>t</mi></msub><mo>=</mo><msub><mi>A</mi><mn>1</mn></msub><msub><mi>Y</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>A</mi><mi>p</mi></msub><msub><mi>Y</mi><mrow><mi>t</mi><mo>−</mo><mi>p</mi></mrow></msub><mo>+</mo><msub><mi>u</mi><mi>t</mi></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>u</mi><mi>t</mi></msub><mo>=</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><msub><mi mathvariant="normal">Σ</mi><mi>u</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Y_t=A_1Y_{t-1}+\cdots+A_pY_{t-p}+u_t,\  u_t=N(0,\Sigma_u)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28055599999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">Σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">A_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是一个 K×K 系数矩阵</p>
<h3 id="模型拟合model-fitting"><a class="markdownIt-Anchor" href="#模型拟合model-fitting"></a> 模型拟合(Model fitting)</h3>
<p><code>statsmodels.tsa.api</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> <span class="comment"># some example data  </span></span><br><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> pandas  </span><br><span class="line">In [<span class="number">3</span>]: <span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">In [<span class="number">4</span>]: <span class="keyword">from</span> statsmodels.tsa.api <span class="keyword">import</span> VAR, DynamicVAR  </span><br><span class="line">In [<span class="number">5</span>]: mdata = sm.datasets.macrodata.load_pandas().data  </span><br><span class="line">  </span><br><span class="line"> <span class="comment"># prepare the dates index  </span></span><br><span class="line">In [<span class="number">6</span>]: dates = mdata[[<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;quarter&#x27;</span>]].astype(<span class="built_in">int</span>).astype(<span class="built_in">str</span>)  </span><br><span class="line">In [<span class="number">7</span>]: quarterly = dates[<span class="string">&quot;year&quot;</span>] + <span class="string">&quot;Q&quot;</span> + dates[<span class="string">&quot;quarter&quot;</span>]  </span><br><span class="line">In [<span class="number">8</span>]: <span class="keyword">from</span> statsmodels.tsa.base.datetools <span class="keyword">import</span> dates_from_str  </span><br><span class="line">In [<span class="number">9</span>]: quarterly = dates_from_str(quarterly)  </span><br><span class="line">In [<span class="number">10</span>]: mdata = mdata[[<span class="string">&#x27;realgdp&#x27;</span>,<span class="string">&#x27;realcons&#x27;</span>,<span class="string">&#x27;realinv&#x27;</span>]]  </span><br><span class="line">In [<span class="number">11</span>]: mdata.index = pandas.DatetimeIndex(quarterly)  </span><br><span class="line">In [<span class="number">12</span>]: data = np.log(mdata).diff().dropna()  </span><br><span class="line">  </span><br><span class="line"> <span class="comment"># make a VAR model  </span></span><br><span class="line">In [<span class="number">13</span>]: model = VAR(data)  </span><br><span class="line">In [<span class="number">14</span>]: results = model.fit(<span class="number">2</span>)  </span><br><span class="line">In [<span class="number">15</span>]: results.summary()  </span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：本VAR类假定通过时间序列是静止的。非静态或趋势数据通常可以通过第一差分或一些其他方法变换为静止的。对于非平稳时间序列的直接分析，标准稳定VAR（p）模型是不合适的。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">16</span>]: results.plot()  </span><br><span class="line">Out[<span class="number">16</span>]: &lt;Figure size 1000x1000 <span class="keyword">with</span> <span class="number">3</span> Axes&gt;  </span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/var.png" alt="pre" width="75%;"/>  
<p>绘制时间序列自相关函数：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">17</span>]: results.plot_acorr()  </span><br><span class="line">Out[<span class="number">17</span>]: &lt;Figure size 1000x1000 <span class="keyword">with</span> <span class="number">9</span> Axes&gt;  </span><br></pre></td></tr></table></figure>
<h3 id="滞后顺序选择lag-order-selection"><a class="markdownIt-Anchor" href="#滞后顺序选择lag-order-selection"></a> 滞后顺序选择(Lag order selection)</h3>
<p>滞后顺序的选择可能是一个难题。标准分析采用可能性测试或基于信息标准的顺序选择。我们已经实现了后者，可通过VAR模型访问：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">18</span>]: model.select_order(<span class="number">15</span>)  </span><br><span class="line">Out[<span class="number">18</span>]: &lt;statsmodels.tsa.vector_ar.var_model.LagOrderResults at <span class="number">0x10c89fef0</span>&gt;  </span><br><span class="line"><span class="comment"># 调用fit函数时，可以传递最大滞后数和order标准以用于order选择  </span></span><br><span class="line">In [<span class="number">19</span>]: results = model.fit(maxlags=<span class="number">15</span>, ic=<span class="string">&#x27;aic&#x27;</span>)  </span><br></pre></td></tr></table></figure>
<h3 id="预测forecasting"><a class="markdownIt-Anchor" href="#预测forecasting"></a> 预测(Forecasting)</h3>
<p>The linear predictor is the optimal h-step ahead forecast in terms of mean-squared error:<br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>t</mi></msub><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ν</mi><mo>+</mo><msub><mi>A</mi><mn>1</mn></msub><msub><mi>y</mi><mi>t</mi></msub><mo stretchy="false">(</mo><mi>h</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mo>⋯</mo><mo>+</mo><msub><mi>A</mi><mi>p</mi></msub><msub><mi>y</mi><mi>t</mi></msub><mo stretchy="false">(</mo><mi>h</mi><mo>−</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y_t(h)=ν+A_1y_t(h-1)+\cdots+A_py_t(h-p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.06366em;">ν</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span><br />
我们可以使用预测函数来生成此预测。请注意，我们必须为预测指定“初始值”：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">20</span>]: lag_order = results.k_ar  </span><br><span class="line">In [<span class="number">21</span>]: results.forecast(data.values[-lag_order:], <span class="number">5</span>)  </span><br><span class="line">Out[<span class="number">21</span>]:   </span><br><span class="line">array([[ <span class="number">0.0062</span>,  <span class="number">0.005</span> ,  <span class="number">0.0092</span>],  </span><br><span class="line">       [ <span class="number">0.0043</span>,  <span class="number">0.0034</span>, -<span class="number">0.0024</span>],  </span><br><span class="line">       [ <span class="number">0.0042</span>,  <span class="number">0.0071</span>, -<span class="number">0.0119</span>],  </span><br><span class="line">       [ <span class="number">0.0056</span>,  <span class="number">0.0064</span>,  <span class="number">0.0015</span>],  </span><br><span class="line">       [ <span class="number">0.0063</span>,  <span class="number">0.0067</span>,  <span class="number">0.0038</span>]])  </span><br><span class="line">In [<span class="number">22</span>]: results.plot_forecast(<span class="number">10</span>)  </span><br><span class="line">Out[<span class="number">22</span>]: &lt;Figure size 1000x1000 <span class="keyword">with</span> <span class="number">3</span> Axes&gt;  </span><br></pre></td></tr></table></figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/forecast.png"  width="75%" height="75%"/>  
<h3 id="脉冲响应分析impulse-response-analysis"><a class="markdownIt-Anchor" href="#脉冲响应分析impulse-response-analysis"></a> 脉冲响应分析(Impulse Response Analysis)</h3>
<p>在计量经济学研究中，脉冲响应是有意义的：它们是对其中一个变量中单位脉冲的估计响应。它们是在实践中使用<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mi>A</mi><mo stretchy="false">(</mo><mi mathvariant="normal">∞</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">MA(\infty)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord">∞</span><span class="mclose">)</span></span></span></span>计算<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi>A</mi><mi>R</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VAR(p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span>过程：<br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Y</mi><mi>t</mi></msub><mo>=</mo><mi>μ</mi><mo>+</mo><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">∞</mi></munderover><msub><mi mathvariant="normal">Φ</mi><mi>i</mi></msub><msub><mi>u</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mstyle></mrow><annotation encoding="application/x-tex">Y_t=\mu + \displaystyle\sum_{i=0}^{\infty} \Phi_i u_{t-i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">Φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mbin mtight">−</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span><br />
我们可以通过调用VARResults对象上的irf函数来执行脉冲响应分析：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">23</span>]: irf = results.irf(<span class="number">10</span>)  </span><br><span class="line"><span class="comment">#这些可以使用绘图函数以正交或非正交形式可视化。  </span></span><br><span class="line"><span class="comment">#默认情况下，渐近标准误差绘制在95％显着性水平，可由用户修改。  </span></span><br><span class="line">In [<span class="number">24</span>]: irf.plot(orth=<span class="literal">False</span>)  </span><br><span class="line">Out[<span class="number">24</span>]: &lt;Figure size 1000x1000 <span class="keyword">with</span> <span class="number">9</span> Axes&gt;  </span><br><span class="line"><span class="comment">#绘图功能非常灵活，如果需要，只能绘制感兴趣的变量  </span></span><br><span class="line">In [<span class="number">25</span>]: irf.plot(impulse=<span class="string">&#x27;realgdp&#x27;</span>)  </span><br><span class="line">Out[<span class="number">25</span>]: &lt;Figure size 1000x1000 <span class="keyword">with</span> <span class="number">3</span> Axes&gt;  </span><br></pre></td></tr></table></figure>
<p>累积效应 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="normal">Ψ</mi><mi>n</mi></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></msubsup><msub><mi mathvariant="normal">Φ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Psi_n=\sum_{i=0}^n \Phi_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Ψ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.104002em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">Φ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 可以用长期运行效果绘制：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">26</span>]: irf.plot_cum_effects(orth=<span class="literal">False</span>)  </span><br><span class="line">Out[<span class="number">26</span>]: &lt;Figure size 1000x1000 <span class="keyword">with</span> <span class="number">9</span> Axes&gt;  </span><br></pre></td></tr></table></figure>
<h3 id="预测误差方差分解fevd"><a class="markdownIt-Anchor" href="#预测误差方差分解fevd"></a> 预测误差方差分解(FEVD)</h3>
<p>可以使用正交化脉冲响应来分解在<code>i-step</code>预测中<code>k</code>上的分量<code>j</code>的预测误差 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="normal">Θ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Theta_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：<br />
通过<code>fevd</code>函数向前总计步数计算</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">27</span>]: fevd = results.fevd(<span class="number">5</span>)  </span><br><span class="line">In [<span class="number">28</span>]: fevd.summary()  </span><br><span class="line">FEVD <span class="keyword">for</span> realgdp  </span><br><span class="line">      realgdp  realcons   realinv  </span><br><span class="line"><span class="number">0</span>    <span class="number">1.000000</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span>  </span><br><span class="line"><span class="number">1</span>    <span class="number">0.864889</span>  <span class="number">0.129253</span>  <span class="number">0.005858</span>  </span><br><span class="line"><span class="number">2</span>    <span class="number">0.816725</span>  <span class="number">0.177898</span>  <span class="number">0.005378</span>  </span><br><span class="line"><span class="number">3</span>    <span class="number">0.793647</span>  <span class="number">0.197590</span>  <span class="number">0.008763</span>  </span><br><span class="line"><span class="number">4</span>    <span class="number">0.777279</span>  <span class="number">0.208127</span>  <span class="number">0.014594</span>  </span><br><span class="line">  </span><br><span class="line">FEVD <span class="keyword">for</span> realcons  </span><br><span class="line">      realgdp  realcons   realinv  </span><br><span class="line"><span class="number">0</span>    <span class="number">0.359877</span>  <span class="number">0.640123</span>  <span class="number">0.000000</span>  </span><br><span class="line"><span class="number">1</span>    <span class="number">0.358767</span>  <span class="number">0.635420</span>  <span class="number">0.005813</span>  </span><br><span class="line"><span class="number">2</span>    <span class="number">0.348044</span>  <span class="number">0.645138</span>  <span class="number">0.006817</span>  </span><br><span class="line"><span class="number">3</span>    <span class="number">0.319913</span>  <span class="number">0.653609</span>  <span class="number">0.026478</span>  </span><br><span class="line"><span class="number">4</span>    <span class="number">0.317407</span>  <span class="number">0.652180</span>  <span class="number">0.030414</span>  </span><br><span class="line">  </span><br><span class="line">FEVD <span class="keyword">for</span> realinv  </span><br><span class="line">      realgdp  realcons   realinv  </span><br><span class="line"><span class="number">0</span>    <span class="number">0.577021</span>  <span class="number">0.152783</span>  <span class="number">0.270196</span>  </span><br><span class="line"><span class="number">1</span>    <span class="number">0.488158</span>  <span class="number">0.293622</span>  <span class="number">0.218220</span>  </span><br><span class="line"><span class="number">2</span>    <span class="number">0.478727</span>  <span class="number">0.314398</span>  <span class="number">0.206874</span>  </span><br><span class="line"><span class="number">3</span>    <span class="number">0.477182</span>  <span class="number">0.315564</span>  <span class="number">0.207254</span>  </span><br><span class="line"><span class="number">4</span>    <span class="number">0.466741</span>  <span class="number">0.324135</span>  <span class="number">0.209124</span>  </span><br></pre></td></tr></table></figure>
<p>它们也可以通过返回的FEVD对象可视化</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">29</span>]: results.fevd(<span class="number">20</span>).plot()  </span><br><span class="line">Out[<span class="number">29</span>]: &lt;Figure size 1000x1000 <span class="keyword">with</span> <span class="number">3</span> Axes&gt;  </span><br></pre></td></tr></table></figure>
<h3 id="统计检验statistical-tests"><a class="markdownIt-Anchor" href="#统计检验statistical-tests"></a> 统计检验(Statistical tests)</h3>
<p>提供了许多不同的方法来进行关于模型结果的假设检验以及模型假设的正确性(normality, whiteness / “iid-ness” of errors, etc)</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://baike.baidu.com/item/%E6%A0%BC%E5%85%B0%E6%9D%B0%E5%9B%A0%E6%9E%9C%E5%85%B3%E7%B3%BB%E6%A3%80%E9%AA%8C/2485970"><strong>格兰杰因果关系(Granger causality)</strong></a></p>
<ul>
<li>格兰杰本人在其2003年获奖演说中强调了其引用的局限性，以及“很多荒谬论文的出现”（Of course, many ridiculous papers appeared）。由于其统计学本质上是对平稳时间序列数据一种预测，仅适用于计量经济学的变量预测，不能作为检验真正因果性的判据。</li>
<li>在时间序列情形下，两个经济变量X、Y之间的格兰杰因果关系定义为：若在包含了变量X、Y的过去信息的条件下，对变量Y的预测效果要优于只单独由Y的过去信息对Y进行的预测效果，即变量X有助于解释变量Y的将来变化，则认为变量X是引致变量Y的格兰杰原因。</li>
<li>进行格兰杰因果关系检验的一个前提条件是时间序列必须具有平稳性，否则可能会出现虚假回归问题。因此在进行格兰杰因果关系检验之前首先应对各指标时间序列的平稳性进行单位根检验(unit root test)。常用增广的迪基—富勒检验(ADF检验)来分别对各指标序列的平稳性进行单位根检验</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">30</span>]: results.test_causality(<span class="string">&#x27;realgdp&#x27;</span>, [<span class="string">&#x27;realinv&#x27;</span>, <span class="string">&#x27;realcons&#x27;</span>], kind=<span class="string">&#x27;f&#x27;</span>)  </span><br><span class="line">Out[<span class="number">30</span>]: &lt;statsmodels.tsa.vector_ar.hypothesis_test_results.CausalityTestResults at <span class="number">0x10ca15978</span>&gt;  </span><br></pre></td></tr></table></figure>
<h3 id="动态矢量自动回归dynamic-vector-autoregressions"><a class="markdownIt-Anchor" href="#动态矢量自动回归dynamic-vector-autoregressions"></a> 动态矢量自动回归(Dynamic Vector Autoregressions)</h3>
<blockquote>
<p>注意：要使用此功能， 必须安装pandas</p>
</blockquote>
<p>人们通常对估计时间序列数据的移动窗口回归感兴趣，以便在整个数据样本中进行预测。例如，我们可能希望生成由每个时间点估计的VAR(p)模型产生的一系列两步预测。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">31</span>]: np.random.seed(<span class="number">1</span>)  </span><br><span class="line">In [<span class="number">32</span>]: <span class="keyword">import</span> pandas.util.testing <span class="keyword">as</span> ptest  </span><br><span class="line">In [<span class="number">33</span>]: ptest.N = <span class="number">500</span>  </span><br><span class="line">In [<span class="number">34</span>]: data = ptest.makeTimeDataFrame().cumsum(<span class="number">0</span>)  </span><br><span class="line">In [<span class="number">35</span>]: data  </span><br><span class="line">Out[<span class="number">35</span>]:   </span><br><span class="line">                    A          B          C          D  </span><br><span class="line"><span class="number">2000</span>-01-03   <span class="number">1.624345</span>  -<span class="number">1.719394</span>  -<span class="number">0.153236</span>   <span class="number">1.301225</span>  </span><br><span class="line"><span class="number">2000</span>-01-04   <span class="number">1.012589</span>  -<span class="number">1.662273</span>  -<span class="number">2.585745</span>   <span class="number">0.988833</span>  </span><br><span class="line"><span class="number">2000</span>-01-05   <span class="number">0.484417</span>  -<span class="number">2.461821</span>  -<span class="number">2.077760</span>   <span class="number">0.717604</span>  </span><br><span class="line"><span class="number">2000</span>-01-06  -<span class="number">0.588551</span>  -<span class="number">2.753416</span>  -<span class="number">2.401793</span>   <span class="number">2.580517</span>  </span><br><span class="line"><span class="number">2000</span>-01-07   <span class="number">0.276856</span>  -<span class="number">3.012398</span>  -<span class="number">3.912869</span>   <span class="number">1.937644</span>  </span><br><span class="line"><span class="meta">... </span>              ...        ...        ...        ...  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">26</span>  <span class="number">29.552085</span>  <span class="number">14.274036</span>  <span class="number">39.222558</span> -<span class="number">13.243907</span>  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">27</span>  <span class="number">30.080964</span>  <span class="number">11.996738</span>  <span class="number">38.589968</span> -<span class="number">12.682989</span>  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">28</span>  <span class="number">27.843878</span>  <span class="number">11.927114</span>  <span class="number">38.380121</span> -<span class="number">13.604648</span>  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">29</span>  <span class="number">26.736165</span>  <span class="number">12.280984</span>  <span class="number">40.277282</span> -<span class="number">12.957273</span>  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">30</span>  <span class="number">26.718447</span>  <span class="number">12.094029</span>  <span class="number">38.895890</span> -<span class="number">11.570447</span>  </span><br><span class="line">  </span><br><span class="line">[<span class="number">500</span> rows x <span class="number">4</span> columns]  </span><br><span class="line">In [<span class="number">36</span>]: var = DynamicVAR(data, lag_order=<span class="number">2</span>, window_type=<span class="string">&#x27;expanding&#x27;</span>)  </span><br></pre></td></tr></table></figure>
<p>动态模型的估计系数作为pandas.Panel对象返回 ，这可以让您轻松地按等式或按日期检查所有模型系数：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">37</span>]: <span class="keyword">import</span> datetime <span class="keyword">as</span> dt  </span><br><span class="line">In [<span class="number">38</span>]: var.coefs  </span><br><span class="line">Out[<span class="number">38</span>]:   </span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">pandas</span>.<span class="title">core</span>.<span class="title">panel</span>.<span class="title">Panel</span>&#x27;&gt;  </span></span><br><span class="line"><span class="class"><span class="title">Dimensions</span>:</span> <span class="number">9</span> (items) x <span class="number">489</span> (major_axis) x <span class="number">4</span> (minor_axis)  </span><br><span class="line">Items axis: L1.A to intercept  </span><br><span class="line">Major_axis axis: <span class="number">2000</span>-01-<span class="number">18</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> to <span class="number">2001</span>-<span class="number">11</span>-<span class="number">30</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  </span><br><span class="line">Minor_axis axis: A to D  </span><br><span class="line">  </span><br><span class="line"> <span class="comment"># all estimated coefficients for equation A  </span></span><br><span class="line">In [<span class="number">39</span>]: var.coefs.minor_xs(<span class="string">&#x27;A&#x27;</span>).info()  </span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">pandas</span>.<span class="title">core</span>.<span class="title">frame</span>.<span class="title">DataFrame</span>&#x27;&gt;  </span></span><br><span class="line"><span class="class"><span class="title">DatetimeIndex</span>:</span> <span class="number">489</span> entries, <span class="number">2000</span>-01-<span class="number">18</span> to <span class="number">2001</span>-<span class="number">11</span>-<span class="number">30</span>  </span><br><span class="line">Freq: B  </span><br><span class="line">Data columns (total <span class="number">9</span> columns):  </span><br><span class="line">L1.A         <span class="number">489</span> non-null float64  </span><br><span class="line">L1.B         <span class="number">489</span> non-null float64  </span><br><span class="line">L1.C         <span class="number">489</span> non-null float64  </span><br><span class="line">L1.D         <span class="number">489</span> non-null float64  </span><br><span class="line">L2.A         <span class="number">489</span> non-null float64  </span><br><span class="line">L2.B         <span class="number">489</span> non-null float64  </span><br><span class="line">L2.C         <span class="number">489</span> non-null float64  </span><br><span class="line">L2.D         <span class="number">489</span> non-null float64  </span><br><span class="line">intercept    <span class="number">489</span> non-null float64  </span><br><span class="line">dtypes: float64(<span class="number">9</span>)  </span><br><span class="line">memory usage: <span class="number">58.2</span> KB  </span><br><span class="line">  </span><br><span class="line"> <span class="comment"># coefficients on 11/30/2001  </span></span><br><span class="line">In [<span class="number">40</span>]: var.coefs.major_xs(dt.datetime(<span class="number">2001</span>, <span class="number">11</span>, <span class="number">30</span>)).T  </span><br><span class="line">Out[<span class="number">40</span>]:   </span><br><span class="line">                  A         B         C         D  </span><br><span class="line">L1.A       <span class="number">0.971964</span>  <span class="number">0.045960</span>  <span class="number">0.003883</span>  <span class="number">0.003822</span>  </span><br><span class="line">L1.B       <span class="number">0.043951</span>  <span class="number">0.937964</span>  <span class="number">0.000735</span>  <span class="number">0.020823</span>  </span><br><span class="line">L1.C       <span class="number">0.038144</span>  <span class="number">0.018260</span>  <span class="number">0.977037</span>  <span class="number">0.129287</span>  </span><br><span class="line">L1.D       <span class="number">0.038618</span>  <span class="number">0.036180</span>  <span class="number">0.052855</span>  <span class="number">1.002657</span>  </span><br><span class="line">L2.A       <span class="number">0.013588</span> -<span class="number">0.046791</span>  <span class="number">0.011558</span> -<span class="number">0.005300</span>  </span><br><span class="line">L2.B      -<span class="number">0.048885</span>  <span class="number">0.041853</span>  <span class="number">0.012185</span> -<span class="number">0.048732</span>  </span><br><span class="line">L2.C      -<span class="number">0.029426</span> -<span class="number">0.015238</span>  <span class="number">0.011520</span> -<span class="number">0.119014</span>  </span><br><span class="line">L2.D      -<span class="number">0.049945</span> -<span class="number">0.025419</span> -<span class="number">0.045621</span> -<span class="number">0.019496</span>  </span><br><span class="line">intercept  <span class="number">0.113331</span>  <span class="number">0.248795</span> -<span class="number">0.058837</span> -<span class="number">0.089302</span>  </span><br></pre></td></tr></table></figure>
<p>可以使用<code>forecast</code>函数生成前面给定步骤的动态预测，并返回pandas.DataMatrix对象：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">41</span>]: var.forecast(<span class="number">2</span>)  </span><br><span class="line">Out[<span class="number">41</span>]:   </span><br><span class="line">                     A          B           C           D  </span><br><span class="line"><span class="number">2000</span>-01-<span class="number">20</span> -<span class="number">260.325888</span> -<span class="number">23.141610</span>  <span class="number">104.930427</span> -<span class="number">134.489882</span>  </span><br><span class="line"><span class="number">2000</span>-01-<span class="number">21</span>  -<span class="number">52.121483</span> -<span class="number">11.566786</span>   <span class="number">29.383608</span>  -<span class="number">15.099109</span>  </span><br><span class="line"><span class="number">2000</span>-01-<span class="number">24</span>  -<span class="number">54.900049</span> -<span class="number">23.894858</span>   <span class="number">40.470913</span>  -<span class="number">19.199059</span>  </span><br><span class="line"><span class="number">2000</span>-01-<span class="number">25</span>   -<span class="number">7.493484</span>  -<span class="number">4.057529</span>    <span class="number">6.682707</span>    <span class="number">4.301623</span>  </span><br><span class="line"><span class="number">2000</span>-01-<span class="number">26</span>   -<span class="number">6.866108</span>  -<span class="number">5.065873</span>    <span class="number">5.623590</span>    <span class="number">0.796081</span>  </span><br><span class="line"><span class="meta">... </span>               ...        ...         ...         ...  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">26</span>   <span class="number">31.886126</span>  <span class="number">13.515527</span>   <span class="number">37.618145</span>  -<span class="number">11.464682</span>  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">27</span>   <span class="number">32.314633</span>  <span class="number">14.237672</span>   <span class="number">37.397691</span>  -<span class="number">12.809727</span>  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">28</span>   <span class="number">30.896528</span>  <span class="number">15.488388</span>   <span class="number">38.541596</span>  -<span class="number">13.129524</span>  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">29</span>   <span class="number">30.077228</span>  <span class="number">15.533337</span>   <span class="number">38.734096</span>  -<span class="number">12.900891</span>  </span><br><span class="line"><span class="number">2001</span>-<span class="number">11</span>-<span class="number">30</span>   <span class="number">30.510380</span>  <span class="number">13.491615</span>   <span class="number">38.088228</span>  -<span class="number">12.384976</span>  </span><br><span class="line">  </span><br><span class="line">[<span class="number">487</span> rows x <span class="number">4</span> columns]  </span><br></pre></td></tr></table></figure>
<p>可以使用plot_forecast显示预测：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">42</span>]: var.plot_forecast(<span class="number">2</span>)  </span><br></pre></td></tr></table></figure>
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/dvar_forecast.png" alt="forecast" width="75%" height="75%"/>
<h1 id="生存分析"><a class="markdownIt-Anchor" href="#生存分析"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/duration.html">生存分析</a></h1>
<p>生存分析是用于分析直到一个或多个事件发生的预期持续时间的统计分支，例如生物有机体中的死亡和机械系统中的失败。本主题被称为可靠性理论和可靠性分析的工程，持续时间分析或持续时间建模在经济学和事件历史分析，在社会学。生存分析试图回答以下问题：在一定时间内存活的人口比例是多少？那些幸存下来的人会以什么样的速度死亡或失败？可以考虑多种死亡原因吗？具体情况或特征如何增加或减少生存的概率？<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Survival_analysis">–<em>Wiki</em></a></p>
<p>理论链接：<br />
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/wwxbi/p/6136348.html">生存分析(survival analysis)</a><br />
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/jaen_tail/article/details/79081954">生存分析学习笔记</a></p>
<p><code>statsmodels.duration</code>实现了几种处理删失数据的标准方法。当数据由起始时间点和某些感兴趣事件发生的时间之间的持续时间组成时，最常使用这些方法。</p>
<p>目前只处理右侧审查。当我们知道在给定时间t之后发生事件时发生了右删失，但我们不知道确切的事件时间。</p>
<h2 id="生存函数估计和推理"><a class="markdownIt-Anchor" href="#生存函数估计和推理"></a> 生存函数估计和推理</h2>
<p><code>statsmodels.api.SurvfuncRight</code>类可以被用来估计可以右删失数据的生存函数。 <code>SurvfuncRight</code>实现了几个推理程序，包括生存分布分位数的置信区间，生存函数的逐点和同时置信带以及绘图程序。<code>duration.survdiff</code>函数提供了比较生存分布的检验程序。</p>
<p><strong>Example</strong><br />
在这里，我们SurvfuncRight使用flchain研究中的数据创建一个对象 ，该数据可通过R数据集存储库获得。我们只适合女性受试者的生存分布。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">  </span><br><span class="line">data = sm.datasets.get_rdataset(<span class="string">&quot;flchain&quot;</span>, <span class="string">&quot;survival&quot;</span>).data  </span><br><span class="line">df = data.loc[data.sex == <span class="string">&quot;F&quot;</span>, :]  </span><br><span class="line">sf = sm.SurvfuncRight(df[<span class="string">&quot;futime&quot;</span>], df[<span class="string">&quot;death&quot;</span>])  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 通过调用summary方法可以看出拟合生存分布的主要特征  </span></span><br><span class="line">sf.summary().head()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#我们可以获得生存分布的分位数的点估计和置信区间。  </span></span><br><span class="line"><span class="comment">#由于在这项研究中只有约30％的受试者死亡，我们只能估计低于0.3概率点的分位数  </span></span><br><span class="line">sf.quantile(<span class="number">0.25</span>)  </span><br><span class="line">sf.quantile_ci(<span class="number">0.25</span>)  </span><br></pre></td></tr></table></figure>
<p>要绘制单个生存函数，请调用plot方法：<br />
<code>sf.plot()</code><br />
由于这是一个包含大量删失的大型数据集，我们可能希望不绘制删失符号：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fig = sf.plot()  </span><br><span class="line">ax = fig.get_axes()[<span class="number">0</span>]  </span><br><span class="line">pt = ax.get_lines()[<span class="number">1</span>]  </span><br><span class="line">pt.set_visible(<span class="literal">False</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#我们还可以为情节添加95％的同时置信带。通常，这些波段仅针对分布的中心部分绘制。  </span></span><br><span class="line">fig = sf.plot()  </span><br><span class="line">lcb, ucb = sf.simultaneous_cb()  </span><br><span class="line">ax = fig.get_axes()[<span class="number">0</span>]  </span><br><span class="line">ax.fill_between(sf.surv_times, lcb, ucb, color=<span class="string">&#x27;lightgrey&#x27;</span>)  </span><br><span class="line">ax.set_xlim(<span class="number">365</span>, <span class="number">365</span>*<span class="number">10</span>)  </span><br><span class="line">ax.set_ylim(<span class="number">0.7</span>, <span class="number">1</span>)  </span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Proportion alive&quot;</span>)  </span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Days since enrollment&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#在这里，我们在同一轴上绘制两组（女性和男性）的生存函数：  </span></span><br><span class="line">gb = data.groupby(<span class="string">&quot;sex&quot;</span>)  </span><br><span class="line">ax = plt.axes()  </span><br><span class="line">sexes = []  </span><br><span class="line"><span class="keyword">for</span> g <span class="keyword">in</span> gb:  </span><br><span class="line">    sexes.append(g[<span class="number">0</span>])  </span><br><span class="line">    sf = sm.SurvfuncRight(g[<span class="number">1</span>][<span class="string">&quot;futime&quot;</span>], g[<span class="number">1</span>][<span class="string">&quot;death&quot;</span>])  </span><br><span class="line">    sf.plot(ax)  </span><br><span class="line">li = ax.get_lines()  </span><br><span class="line">li[<span class="number">1</span>].set_visible(<span class="literal">False</span>)  </span><br><span class="line">li[<span class="number">3</span>].set_visible(<span class="literal">False</span>)  </span><br><span class="line">plt.figlegend((li[<span class="number">0</span>], li[<span class="number">2</span>]), sexes, <span class="string">&quot;center right&quot;</span>)  </span><br><span class="line">plt.ylim(<span class="number">0.6</span>, <span class="number">1</span>)  </span><br><span class="line">ax.set_ylabel(<span class="string">&quot;Proportion alive&quot;</span>)  </span><br><span class="line">ax.set_xlabel(<span class="string">&quot;Days since enrollment&quot;</span>)  </span><br></pre></td></tr></table></figure>
<p>我们可以正式比较两个生存分布<code>survdiff</code>，它实现了几个标准的非参数程序。默认程序是<code>logrank</code>检测：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">stat, pv = sm.duration.survdiff(data.futime, data.death, data.sex)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#以下是survdiff实施的一些其他测试程序  </span></span><br><span class="line"><span class="comment"># Fleming-Harrington with p=1, i.e. weight by pooled survival time  </span></span><br><span class="line">stat, pv = sm.duration.survdiff(data.futime, data.death, data.sex, weight_type=<span class="string">&#x27;fh&#x27;</span>, fh_p=<span class="number">1</span>)  </span><br><span class="line"><span class="comment"># Gehan-Breslow, weight by number at risk  </span></span><br><span class="line">stat, pv = sm.duration.survdiff(data.futime, data.death, data.sex, weight_type=<span class="string">&#x27;gb&#x27;</span>)  </span><br><span class="line"><span class="comment"># Tarone-Ware, weight by the square root of the number at risk  </span></span><br><span class="line">stat, pv = sm.duration.survdiff(data.futime, data.death, data.sex, weight_type=<span class="string">&#x27;tw&#x27;</span>)  </span><br></pre></td></tr></table></figure>
<h2 id="回归方法"><a class="markdownIt-Anchor" href="#回归方法"></a> 回归方法</h2>
<p>比例风险回归模型（“Cox模型”）是用于删失数据的回归技术。它们允许以协变量的形式解释事件的时间变化，类似于线性或广义线性回归模型中所做的。这些模型以“风险比”表示协变量效应，这意味着危险（瞬时事件率）乘以给定因子，取决于协变量的值。</p>
<p><strong>Example</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line"><span class="keyword">import</span> statsmodels.formula.api <span class="keyword">as</span> smf  </span><br><span class="line">  </span><br><span class="line">data = sm.datasets.get_rdataset(<span class="string">&quot;flchain&quot;</span>, <span class="string">&quot;survival&quot;</span>).data  </span><br><span class="line"><span class="keyword">del</span> data[<span class="string">&quot;chapter&quot;</span>]  </span><br><span class="line">data = data.dropna()  </span><br><span class="line">data[<span class="string">&quot;lam&quot;</span>] = data[<span class="string">&quot;lambda&quot;</span>]  </span><br><span class="line">data[<span class="string">&quot;female&quot;</span>] = (data[<span class="string">&quot;sex&quot;</span>] == <span class="string">&quot;F&quot;</span>).astype(<span class="built_in">int</span>)  </span><br><span class="line">data[<span class="string">&quot;year&quot;</span>] = data[<span class="string">&quot;sample.yr&quot;</span>] - <span class="built_in">min</span>(data[<span class="string">&quot;sample.yr&quot;</span>])  </span><br><span class="line">status = data[<span class="string">&quot;death&quot;</span>].values  </span><br><span class="line">  </span><br><span class="line">mod = smf.phreg(<span class="string">&quot;futime ~ 0 + age + female + creatinine + &quot;</span>  </span><br><span class="line">                <span class="string">&quot;np.sqrt(kappa) + np.sqrt(lam) + year + mgus&quot;</span>,  </span><br><span class="line">                data, status=status, ties=<span class="string">&quot;efron&quot;</span>)  </span><br><span class="line">rslt = mod.fit()  </span><br><span class="line"><span class="built_in">print</span>(rslt.summary())  </span><br></pre></td></tr></table></figure>
<h1 id="列联表"><a class="markdownIt-Anchor" href="#列联表"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/contingency_tables.html">列联表</a></h1>
<p>Statsmodels支持各种分析列联表的方法，包括评估独立性，对称性，同质性的方法，以及处理来自分层人群的表集合的方法。</p>
<p>这里描述的方法主要用于双向表。可以使用对数线性模型分析多路表。Statsmodels目前没有statsmodels.genmod.GLM用于对数线性建模的专用API，但Poisson回归可用于此目的。</p>
<p><code>from statsmodels import stats</code></p>
<table>
<thead>
<tr>
<th style="text-align:left">类</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Table</td>
<td style="text-align:left">双向应变表列联表</td>
</tr>
<tr>
<td style="text-align:left">Table2x2</td>
<td style="text-align:left">可以在2x2列联表上执行分析</td>
</tr>
<tr>
<td style="text-align:left">SquareTable</td>
<td style="text-align:left">分析方形列联表的方法</td>
</tr>
<tr>
<td style="text-align:left">StratifiedTable</td>
<td style="text-align:left">分析2×2列联表的集合</td>
</tr>
<tr>
<td style="text-align:left">mcnemar</td>
<td style="text-align:left">McNemar同质性测试</td>
</tr>
<tr>
<td style="text-align:left">cochrans_q</td>
<td style="text-align:left">Cochran对相同二项式比例的Q检验</td>
</tr>
</tbody>
</table>
<p>statsmodels.stats.Table是使用列联表的最基本的类。我们可以Table直接从任何包含列联表单元格计数的矩形数组对象创建对象：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line">In [<span class="number">2</span>]: <span class="keyword">import</span> pandas <span class="keyword">as</span> pd  </span><br><span class="line">In [<span class="number">3</span>]: <span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line">In [<span class="number">4</span>]: df = sm.datasets.get_rdataset(<span class="string">&quot;Arthritis&quot;</span>, <span class="string">&quot;vcd&quot;</span>).data  </span><br><span class="line">In [<span class="number">5</span>]: tab = pd.crosstab(df[<span class="string">&#x27;Treatment&#x27;</span>], df[<span class="string">&#x27;Improved&#x27;</span>])  </span><br><span class="line">In [<span class="number">6</span>]: tab = tab.loc[:, [<span class="string">&quot;None&quot;</span>, <span class="string">&quot;Some&quot;</span>, <span class="string">&quot;Marked&quot;</span>]]  </span><br><span class="line">In [<span class="number">7</span>]: table = sm.stats.Table(tab)  </span><br></pre></td></tr></table></figure>
<p>或者，我们可以传递原始数据，让Table类为我们构建单元格数组：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">8</span>]: table = sm.stats.Table.from_data(df[[<span class="string">&quot;Treatment&quot;</span>, <span class="string">&quot;Improved&quot;</span>]])  </span><br></pre></td></tr></table></figure>
<h2 id="independence独立性"><a class="markdownIt-Anchor" href="#independence独立性"></a> Independence(独立性)</h2>
<p>独立性(Independence)是行和列因子独立出现的属性。联合(Association)缺乏独立性。如果联合分布是独立的，则可以将其写为行和列边缘分布的外积</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>⋅</mo><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>P</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_ {ij} = \sum_k P_ {ij} \cdot \sum_k P_ {kj}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1863979999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1863979999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>我们可以为我们观察到的数据获得最佳拟合的独立分布，然后查看识别最强烈违反独立性的特定残差</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">9</span>]: <span class="built_in">print</span>(table.table_orig)  </span><br><span class="line">Improved   Marked  <span class="literal">None</span>  Some  </span><br><span class="line">Treatment                      </span><br><span class="line">Placebo         <span class="number">7</span>    <span class="number">29</span>     <span class="number">7</span>  </span><br><span class="line">Treated        <span class="number">21</span>    <span class="number">13</span>     <span class="number">7</span>  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">10</span>]: <span class="built_in">print</span>(table.fittedvalues)  </span><br><span class="line">Improved      Marked  <span class="literal">None</span>      Some  </span><br><span class="line">Treatment                             </span><br><span class="line">Placebo    <span class="number">14.333333</span>  <span class="number">21.5</span>  <span class="number">7.166667</span>  </span><br><span class="line">Treated    <span class="number">13.666667</span>  <span class="number">20.5</span>  <span class="number">6.833333</span>  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">11</span>]: <span class="built_in">print</span>(table.resid_pearson)  </span><br><span class="line">Improved     Marked      <span class="literal">None</span>      Some  </span><br><span class="line">Treatment                                </span><br><span class="line">Placebo   -<span class="number">1.936992</span>  <span class="number">1.617492</span> -<span class="number">0.062257</span>  </span><br><span class="line">Treated    <span class="number">1.983673</span> -<span class="number">1.656473</span>  <span class="number">0.063758</span>  </span><br></pre></td></tr></table></figure>
<p>如果表的行和列是无序的（即名义变量，nominal factors），那么正式评估独立性的最常用方法是使用Pearson的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>统计。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">12</span>]: rslt = table.test_nominal_association()  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">13</span>]: <span class="built_in">print</span>(rslt.pvalue)  </span><br><span class="line"><span class="number">0.0014626434089526352</span>  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">14</span>]: <span class="built_in">print</span>(table.chi2_contribs)  </span><br><span class="line">Improved     Marked      <span class="literal">None</span>      Some  </span><br><span class="line">Treatment                                </span><br><span class="line">Placebo    <span class="number">3.751938</span>  <span class="number">2.616279</span>  <span class="number">0.003876</span>  </span><br><span class="line">Treated    <span class="number">3.934959</span>  <span class="number">2.743902</span>  <span class="number">0.004065</span>  </span><br></pre></td></tr></table></figure>
<p>对于有序行和列因子(factors)的表，我们可以通过线性相关检验，以获得更多权重来对抗关于排序的替代假设。线性相关检验的统计量为<br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>r</mi><mi>i</mi></msub><msub><mi>c</mi><mi>j</mi></msub><msub><mi>T</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sum_k r_i c_j T_ {ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0497100000000001em;vertical-align:-0.29971000000000003em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1863979999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>r</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">r_i ,c_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>是行和列分数。通常将这些分数设置为序列0,1，…<br />
这给出了Cochran-Armitage趋势测试。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">15</span>]: rslt = table.test_ordinal_association()  </span><br><span class="line">In [<span class="number">16</span>]: <span class="built_in">print</span>(rslt.pvalue)  </span><br><span class="line"><span class="number">0.023644578093923983</span>  </span><br></pre></td></tr></table></figure>
<p>我们可以评估再 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mo>×</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">r \times x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> 表中的关联，通过构建一系列<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>表格，并计算它们的比值比(OR)。有两种方法可以做到这一点。从相邻行和列类别的本地优势比(<strong>local odds ratios</strong>)来构建<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>表。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">17</span>]: <span class="built_in">print</span>(table.local_oddsratios)  </span><br><span class="line">Improved     Marked      <span class="literal">None</span>  Some  </span><br><span class="line">Treatment                            </span><br><span class="line">Placebo    <span class="number">0.149425</span>  <span class="number">2.230769</span>   NaN  </span><br><span class="line">Treated         NaN       NaN   NaN  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">18</span>]: taloc = sm.stats.Table2x2(np.asarray([[<span class="number">7</span>, <span class="number">29</span>], [<span class="number">21</span>, <span class="number">13</span>]]))  </span><br><span class="line">In [<span class="number">19</span>]: <span class="built_in">print</span>(taloc.oddsratio)  </span><br><span class="line"><span class="number">0.14942528735632185</span>  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">20</span>]: taloc = sm.stats.Table2x2(np.asarray([[<span class="number">29</span>, <span class="number">7</span>], [<span class="number">13</span>, <span class="number">7</span>]]))  </span><br><span class="line">In [<span class="number">21</span>]: <span class="built_in">print</span>(taloc.oddsratio)  </span><br><span class="line"><span class="number">2.230769230769231</span>  </span><br></pre></td></tr></table></figure>
<p>也可以通过在每个可能的点上对行和列因子进行二分法的累积比值比(<strong>cumulative odds ratios</strong>)来构建<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>表。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">22</span>]: <span class="built_in">print</span>(table.cumulative_oddsratios)  </span><br><span class="line">Improved     Marked      <span class="literal">None</span>  Some  </span><br><span class="line">Treatment                            </span><br><span class="line">Placebo    <span class="number">0.185185</span>  <span class="number">1.058824</span>   NaN  </span><br><span class="line">Treated         NaN       NaN   NaN  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">23</span>]: tab1 = np.asarray([[<span class="number">7</span>, <span class="number">29</span> + <span class="number">7</span>], [<span class="number">21</span>, <span class="number">13</span> + <span class="number">7</span>]])  </span><br><span class="line">In [<span class="number">24</span>]: tacum = sm.stats.Table2x2(tab1)  </span><br><span class="line">In [<span class="number">25</span>]: <span class="built_in">print</span>(tacum.oddsratio)  </span><br><span class="line"><span class="number">0.18518518518518517</span>  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">26</span>]: tab1 = np.asarray([[<span class="number">7</span> + <span class="number">29</span>, <span class="number">7</span>], [<span class="number">21</span> + <span class="number">13</span>, <span class="number">7</span>]])  </span><br><span class="line">In [<span class="number">27</span>]: tacum = sm.stats.Table2x2(tab1)  </span><br><span class="line">In [<span class="number">28</span>]: <span class="built_in">print</span>(tacum.oddsratio)  </span><br><span class="line"><span class="number">1.0588235294117647</span>  </span><br></pre></td></tr></table></figure>
<p>马赛克图(mosaic plot)是一种非正式评估双向表中依赖性的图形方法。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> statsmodels.graphics.mosaicplot <span class="keyword">import</span> mosaic  </span><br><span class="line">mosaic(data)  </span><br></pre></td></tr></table></figure>
<h2 id="symmetry-and-homogeneity对称性和同质性"><a class="markdownIt-Anchor" href="#symmetry-and-homogeneity对称性和同质性"></a> Symmetry and homogeneity(对称性和同质性)</h2>
<p>Symmetry(对称性) is the property<br />
that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>P</mi><mrow><mi>j</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{i,j}=P_{j,i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>  for every i and j。<br />
Homogeneity(同质性)是行因子和列因子的边际分布相同的特性<br />
meaning that  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>P</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mo>∑</mo><mi>j</mi></msub><msub><mi>P</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\sum_j P_ {ij} = \sum_j P_ {ji}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185818em;vertical-align:-0.43581800000000004em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.185818em;vertical-align:-0.43581800000000004em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16195399999999993em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> for all i</p>
<blockquote>
<p>注意，P (and T)必须是正方形，行和列类别必须相同，并且必须以相同的顺序出现。</p>
</blockquote>
<p>为了说明，我们加载数据集，创建列联表，并计算行和列边距(the row and column margins)。本<code>Table</code>类包含分析方法<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi><mo>×</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">r \times c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span>列联表。下面加载的数据集包含人们左眼和右眼视敏度的评估。我们首先加载数据并创建一个列联表。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">29</span>]: df = sm.datasets.get_rdataset(<span class="string">&quot;VisualAcuity&quot;</span>, <span class="string">&quot;vcd&quot;</span>).data  </span><br><span class="line">In [<span class="number">30</span>]: df = df.loc[df.gender == <span class="string">&quot;female&quot;</span>, :]  </span><br><span class="line">In [<span class="number">31</span>]: tab = df.set_index([<span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;right&#x27;</span>])  </span><br><span class="line">In [<span class="number">32</span>]: <span class="keyword">del</span> tab[<span class="string">&quot;gender&quot;</span>]  </span><br><span class="line">In [<span class="number">33</span>]: tab = tab.unstack()  </span><br><span class="line">In [<span class="number">34</span>]: tab.columns = tab.columns.get_level_values(<span class="number">1</span>)  </span><br><span class="line">In [<span class="number">35</span>]: <span class="built_in">print</span>(tab)  </span><br><span class="line">right     <span class="number">1</span>     <span class="number">2</span>     <span class="number">3</span>    <span class="number">4</span>  </span><br><span class="line">left                          </span><br><span class="line"><span class="number">1</span>      <span class="number">1520</span>   <span class="number">234</span>   <span class="number">117</span>   <span class="number">36</span>  </span><br><span class="line"><span class="number">2</span>       <span class="number">266</span>  <span class="number">1512</span>   <span class="number">362</span>   <span class="number">82</span>  </span><br><span class="line"><span class="number">3</span>       <span class="number">124</span>   <span class="number">432</span>  <span class="number">1772</span>  <span class="number">179</span>  </span><br><span class="line"><span class="number">4</span>        <span class="number">66</span>    <span class="number">78</span>   <span class="number">205</span>  <span class="number">492</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 从列联表创建一个SquareTable对象  </span></span><br><span class="line">In [<span class="number">36</span>]: sqtab = sm.stats.SquareTable(tab)  </span><br><span class="line">In [<span class="number">37</span>]: row, col = sqtab.marginal_probabilities  </span><br><span class="line">In [<span class="number">38</span>]: <span class="built_in">print</span>(row)  </span><br><span class="line">right  </span><br><span class="line"><span class="number">1</span>    <span class="number">0.255049</span>  </span><br><span class="line"><span class="number">2</span>    <span class="number">0.297178</span>  </span><br><span class="line"><span class="number">3</span>    <span class="number">0.335295</span>  </span><br><span class="line"><span class="number">4</span>    <span class="number">0.112478</span>  </span><br><span class="line">dtype: float64  </span><br><span class="line">  </span><br><span class="line">In [<span class="number">39</span>]: <span class="built_in">print</span>(col)  </span><br><span class="line">right  </span><br><span class="line"><span class="number">1</span>    <span class="number">0.264277</span>  </span><br><span class="line"><span class="number">2</span>    <span class="number">0.301725</span>  </span><br><span class="line"><span class="number">3</span>    <span class="number">0.328474</span>   </span><br><span class="line"><span class="number">4</span>    <span class="number">0.105524</span>  </span><br><span class="line">dtype: float64  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 该summary方法打印对称性和均匀性检测结果  </span></span><br><span class="line">In [<span class="number">40</span>]: <span class="built_in">print</span>(sqtab.summary())   </span><br><span class="line">            Statistic P-value DF  </span><br><span class="line">--------------------------------  </span><br><span class="line">Symmetry       <span class="number">19.107</span>   <span class="number">0.004</span>  <span class="number">6</span>  </span><br><span class="line">Homogeneity    <span class="number">11.957</span>   <span class="number">0.008</span>  <span class="number">3</span>  </span><br><span class="line">--------------------------------  </span><br></pre></td></tr></table></figure>
<h2 id="a-single-2x2-table单个2x2表"><a class="markdownIt-Anchor" href="#a-single-2x2-table单个2x2表"></a> A single 2x2 table(单个2x2表)</h2>
<p><code>sm.stats.Table2x2</code>类提供了几种处理单个2x2表的方法。summary方法显示表的行和列之间的若干关联度量。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">41</span>]: table = np.asarray([[<span class="number">35</span>, <span class="number">21</span>], [<span class="number">25</span>, <span class="number">58</span>]])  </span><br><span class="line">In [<span class="number">42</span>]: t22 = sm.stats.Table2x2(table)  </span><br><span class="line">In [<span class="number">43</span>]: <span class="built_in">print</span>(t22.summary())  </span><br><span class="line">               Estimate   SE   LCB   UCB  p-value  </span><br><span class="line">-------------------------------------------------  </span><br><span class="line">Odds ratio        <span class="number">3.867</span>       <span class="number">1.890</span> <span class="number">7.912</span>   <span class="number">0.000</span>  </span><br><span class="line">Log odds ratio    <span class="number">1.352</span> <span class="number">0.365</span> <span class="number">0.636</span> <span class="number">2.068</span>   <span class="number">0.000</span>  </span><br><span class="line">Risk ratio        <span class="number">2.075</span>       <span class="number">1.411</span> <span class="number">3.051</span>   <span class="number">0.000</span>  </span><br><span class="line">Log risk ratio    <span class="number">0.730</span> <span class="number">0.197</span> <span class="number">0.345</span> <span class="number">1.115</span>   <span class="number">0.000</span>  </span><br><span class="line">-------------------------------------------------  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#请注意，风险比不是对称的，因此如果分析转置表，将获得不同的结果。  </span></span><br><span class="line">In [<span class="number">44</span>]: table = np.asarray([[<span class="number">35</span>, <span class="number">21</span>], [<span class="number">25</span>, <span class="number">58</span>]])  </span><br><span class="line">In [<span class="number">45</span>]: t22 = sm.stats.Table2x2(table.T)  </span><br><span class="line">In [<span class="number">46</span>]: <span class="built_in">print</span>(t22.summary())  </span><br><span class="line">               Estimate   SE   LCB   UCB  p-value  </span><br><span class="line">-------------------------------------------------  </span><br><span class="line">Odds ratio        <span class="number">3.867</span>       <span class="number">1.890</span> <span class="number">7.912</span>   <span class="number">0.000</span>  </span><br><span class="line">Log odds ratio    <span class="number">1.352</span> <span class="number">0.365</span> <span class="number">0.636</span> <span class="number">2.068</span>   <span class="number">0.000</span>  </span><br><span class="line">Risk ratio        <span class="number">2.194</span>       <span class="number">1.436</span> <span class="number">3.354</span>   <span class="number">0.000</span>  </span><br><span class="line">Log risk ratio    <span class="number">0.786</span> <span class="number">0.216</span> <span class="number">0.362</span> <span class="number">1.210</span>   <span class="number">0.000</span>  </span><br><span class="line">-------------------------------------------------  </span><br></pre></td></tr></table></figure>
<h2 id="stratified-2x2-tables分层2x2表"><a class="markdownIt-Anchor" href="#stratified-2x2-tables分层2x2表"></a> Stratified 2x2 tables(分层2x2表)</h2>
<p>当我们有一组由同样行和列因子定义的列联表时，就会发生分层。</p>
<p><strong>案例</strong></p>
<ul>
<li>我们有一组2x2表，反映了中国几个地区吸烟和肺癌的联合分布。表格可能都具有共同的比值比，即使边际概率在各阶层之间变化也是如此。</li>
<li>“Breslow-Day”程序测试数据是否与常见优势比一致。它在下面显示为常数OR的测试。</li>
<li>Mantel-Haenszel程序测试这个常见优势比是否等于1。它在下面显示为OR = 1的测试。还可以估计共同的几率和风险比并获得它们的置信区间。</li>
<li>summary方法显示所有这些结果。可以从类方法和属性中获得单个结果。</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">In [<span class="number">47</span>]: data = sm.datasets.china_smoking.load()  </span><br><span class="line">In [<span class="number">48</span>]: mat = np.asarray(data.data)  </span><br><span class="line">In [<span class="number">49</span>]: tables = [np.reshape(x.tolist()[<span class="number">1</span>:], (<span class="number">2</span>, <span class="number">2</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> mat]  </span><br><span class="line">In [<span class="number">50</span>]: st = sm.stats.StratifiedTable(tables)  </span><br><span class="line">In [<span class="number">51</span>]: <span class="built_in">print</span>(st.summary())  </span><br><span class="line">                   Estimate   LCB    UCB   </span><br><span class="line">-----------------------------------------  </span><br><span class="line">Pooled odds           <span class="number">2.174</span>   <span class="number">1.984</span> <span class="number">2.383</span>  </span><br><span class="line">Pooled log odds       <span class="number">0.777</span>   <span class="number">0.685</span> <span class="number">0.868</span>  </span><br><span class="line">Pooled risk ratio     <span class="number">1.519</span>                </span><br><span class="line">                                           </span><br><span class="line">                 Statistic P-value   </span><br><span class="line">-----------------------------------  </span><br><span class="line">Test of OR=<span class="number">1</span>       <span class="number">280.138</span>   <span class="number">0.000</span>   </span><br><span class="line">Test constant OR     <span class="number">5.200</span>   <span class="number">0.636</span>   </span><br><span class="line">                         </span><br><span class="line">-----------------------  </span><br><span class="line">Number of tables    <span class="number">8</span>    </span><br><span class="line">Min n             <span class="number">213</span>    </span><br><span class="line">Max n            <span class="number">2900</span>    </span><br><span class="line">Avg n            <span class="number">1052</span>    </span><br><span class="line">Total n          <span class="number">8419</span>    </span><br><span class="line">-----------------------  </span><br></pre></td></tr></table></figure>
<h1 id="多重插补"><a class="markdownIt-Anchor" href="#多重插补"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.statsmodels.org/stable/imputation.html">多重插补</a></h1>
<p>MICE模块允许大多数Statsmodels模型拟合独立和/或因变量上具有缺失值的数据集，并为拟合参数提供严格的标准误差。基本思想是将具有缺失值的每个变量视为回归中的因变量，其中一些或所有剩余变量作为其预测变量。MICE程序循环遍历这些模型，依次拟合每个模型，然后使用称为“预测平均匹配”（PMM）的过程从拟合模型确定的预测分布中生成随机抽取。这些随机抽取成为一个插补数据集的估算值。</p>
<p>默认情况下，每个具有缺失变量的变量都使用线性回归建模，拟合数据集中的所有其他变量。请注意，即使插补模型是线性的，PMM过程也会保留每个变量的域。因此，例如，如果给定变量的所有观测值都是正，则变量的所有估算值将始终为正。用户还可以选择指定使用哪个模型为每个变量生成插补值。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> statsmodels.imputation <span class="keyword">import</span> mice  </span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">类</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MICE(model_formula, model_class, data, n_skip=3, init_kwds=None, fit_kwds=None)</td>
<td style="text-align:left">用链式方程多重插补</td>
</tr>
<tr>
<td style="text-align:left">MICEData（data [，perturbation_method，k_pmm，…]）</td>
<td style="text-align:left">包装数据集以允许MICE处理丢失数据</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>MICEData类方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>get_fitting_data</td>
<td>返回进行插补所需的数据</td>
</tr>
<tr>
<td>get_split_data(vname)</td>
<td>返回endog和exog以获取给定变量的插补</td>
</tr>
<tr>
<td>impute(vname)</td>
<td></td>
</tr>
<tr>
<td>impute_pmm(vname)</td>
<td>使用预测均值匹配来估算缺失值</td>
</tr>
<tr>
<td>next_sample()</td>
<td>返回插补过程中的下一个插补数据集</td>
</tr>
<tr>
<td>perturb_params(vname)</td>
<td></td>
</tr>
<tr>
<td>plot_bivariate(col1_name,col2_name [,…])</td>
<td>绘制两个变量的观察值和估算值</td>
</tr>
<tr>
<td>plot_fit_obs(col_name[, lowess_args, …])</td>
<td>绘制拟合估计值或观察值的散点图</td>
</tr>
<tr>
<td>plot_imputed_hist(col_name[, ax, …])</td>
<td>将一个变量的估算值显示为直方图</td>
</tr>
<tr>
<td>plot_missing_pattern([ax, row_order, …])</td>
<td>生成显示缺失数据模式的图像</td>
</tr>
<tr>
<td>set_imputer(endog_name[, formula, …])</td>
<td>指定单个变量的插补过程。</td>
</tr>
<tr>
<td>update(vname)</td>
<td>为单个变量计算缺失值。</td>
</tr>
<tr>
<td>update_all([n_iter])</td>
<td>执行指定数量的MICE迭代。</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>imp = mice.MICEData(data)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fml = <span class="string">&#x27;y ~ x1 + x2 + x3 + x4&#x27;</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mice = mice.MICE(fml, sm.OLS, imp)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>results = mice.fit(<span class="number">10</span>, <span class="number">10</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(results.summary())  </span><br><span class="line">                          Results: MICE  </span><br><span class="line">=================================================================  </span><br><span class="line">Method:                    MICE       Sample size:           <span class="number">1000</span>  </span><br><span class="line">Model:                     OLS        Scale                  <span class="number">1.00</span>  </span><br><span class="line">Dependent variable:        y          Num. imputations       <span class="number">10</span>  </span><br><span class="line">-----------------------------------------------------------------  </span><br><span class="line">           Coef.  Std.Err.    t     P&gt;|t|   [<span class="number">0.025</span>  <span class="number">0.975</span>]  FMI  </span><br><span class="line">-----------------------------------------------------------------  </span><br><span class="line">Intercept -<span class="number">0.0234</span>   <span class="number">0.0318</span>  -<span class="number">0.7345</span> <span class="number">0.4626</span> -<span class="number">0.0858</span>  <span class="number">0.0390</span> <span class="number">0.0128</span>  </span><br><span class="line">x1         <span class="number">1.0305</span>   <span class="number">0.0578</span>  <span class="number">17.8342</span> <span class="number">0.0000</span>  <span class="number">0.9172</span>  <span class="number">1.1437</span> <span class="number">0.0309</span>  </span><br><span class="line">x2        -<span class="number">0.0134</span>   <span class="number">0.0162</span>  -<span class="number">0.8282</span> <span class="number">0.4076</span> -<span class="number">0.0451</span>  <span class="number">0.0183</span> <span class="number">0.0236</span>  </span><br><span class="line">x3        -<span class="number">1.0260</span>   <span class="number">0.0328</span> -<span class="number">31.2706</span> <span class="number">0.0000</span> -<span class="number">1.0903</span> -<span class="number">0.9617</span> <span class="number">0.0169</span>  </span><br><span class="line">x4        -<span class="number">0.0253</span>   <span class="number">0.0336</span>  -<span class="number">0.7520</span> <span class="number">0.4521</span> -<span class="number">0.0911</span>  <span class="number">0.0406</span> <span class="number">0.0269</span>  </span><br><span class="line">=================================================================  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#获得一系列拟合分析模型，无需合并即可获得摘要：  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>imp = mice.MICEData(data)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fml = <span class="string">&#x27;y ~ x1 + x2 + x3 + x4&#x27;</span>  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mice = mice.MICE(fml, sm.OLS, imp)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>results = []  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    x = mice.next_sample()  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    results.append(x)  </span><br></pre></td></tr></table></figure>
<h1 id="多变量统计"><a class="markdownIt-Anchor" href="#多变量统计"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.statsmodels.org/stable/multivariate.html">多变量统计</a></h1>
<p>多变量统计是一种统计方法，当数据种包含不止一个结果变量时，同时进行观察和分析。多变量统计的应用是多变量分析。</p>
<p>多变量统计涉及了解每种不同形式的多变量分析的不同目的和背景，以及它们如何相互关联。多变量统计对特定问题的实际应用可能涉及几种类型的单变量和多变量分析，以便理解变量之间的关系及其与所研究问题的相关性。<em><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Multivariate_statistics">—Wiki</a></em></p>
<p><code>statsmodels.multivariate</code></p>
<h2 id="主成分分析principal-component-analysis"><a class="markdownIt-Anchor" href="#主成分分析principal-component-analysis"></a> 主成分分析(Principal Component Analysis)</h2>
<p>主成分分析是设法将原来众多具有一定相关性（比如P个指标），重新组合成一组新的互相无关的综合指标来代替原来的指标。</p>
<p>主成分分析，是考察多个变量间相关性一种多元统计方法，研究如何通过少数几个主成分来揭示多个变量间的内部结构，即从原始变量中导出少数几个主成分，使它们尽可能多地保留原始变量的信息，且彼此间互不相关.通常数学上的处理就是将原来P个指标作线性组合，作为新的综合指标。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PCA(data, ncomp=<span class="literal">None</span>, standardize=<span class="literal">True</span>, demean=<span class="literal">True</span>, normalize=<span class="literal">True</span>, ...)  </span><br><span class="line">pca(...)  </span><br></pre></td></tr></table></figure>
<p><strong>例子</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> statsmodels.multivariate.pca <span class="keyword">import</span> PCA  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = np.random.randn(<span class="number">100</span>)[:, <span class="literal">None</span>]  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = x + np.random.randn(<span class="number">100</span>, <span class="number">100</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pc = PCA(x)  </span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，主成分是使用SVD计算的，因此从不构造相关矩阵，除非method =‘eig’。</p>
</blockquote>
<p>PCA使用数据的协方差矩阵</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pc = PCA(x, standardize=<span class="literal">False</span>)  </span><br></pre></td></tr></table></figure>
<p>使用NIPALS将返回的因子数限制为1</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>pc = PCA(x, ncomp=<span class="number">1</span>, method=<span class="string">&#x27;nipals&#x27;</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pc.factors.shape  </span><br><span class="line">(<span class="number">100</span>, <span class="number">1</span>)  </span><br></pre></td></tr></table></figure>
<h2 id="因子分析factor-analysis"><a class="markdownIt-Anchor" href="#因子分析factor-analysis"></a> 因子分析(Factor Analysis)</h2>
<p>因子分析法是从研究变量内部相关的依赖关系出发，把一些具有错综复杂关系的变量归结为少数几个综合因子的一种多变量统计分析方法。它的基本思想是将观测变量进行分类，将相关性较高，即联系比较紧密的分在同一类中，而不同类变量之间的相关性则较低，那么每一类变量实际上就代表了一个基本结构，即公共因子（隐性变量, latent variable, latent factor）。对于所研究的问题就是试图用最少个数的不可测的所谓公共因子的线性函数与特殊因子之和来描述原来观测的每一分量。</p>
<p>因子分析的方法有两类。一类是探索性因子分析法，另一类是验证性因子分析。探索性因子分析不事先假定因子与测度项之间的关系，而让数据“自己说话”。主成分分析和共因子分析是其中的典型方法。验证性因子分析假定因子与测度项的关系是部分知道的，即哪个测度项对应于哪个因子，虽然我们尚且不知道具体的系数。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Factor(endog=None, n_factor=1, corr=None,...)  #因子分析  </span><br><span class="line">FactorResults(factor) #因子分析结果类  </span><br></pre></td></tr></table></figure>
<p><strong>因子旋转(Factor Rotation)</strong><br />
<code>statsmodels.multivariate.factor_rotation</code></p>
<table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rotate_factors</td>
<td>矩阵正交和倾斜旋转</td>
</tr>
<tr>
<td>target_rotation</td>
<td>朝向目标矩阵的正交旋转，即最小化：</td>
</tr>
<tr>
<td>procrustes</td>
<td>分析解决Procrustes问题</td>
</tr>
<tr>
<td>promax</td>
<td>执行矩阵的promax旋转</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>A = np.random.randn(<span class="number">8</span>,<span class="number">2</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L, T = rotate_factors(A,<span class="string">&#x27;varimax&#x27;</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.allclose(L,A.dot(T))  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L, T = rotate_factors(A,<span class="string">&#x27;orthomax&#x27;</span>,<span class="number">0.5</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.allclose(L,A.dot(T))  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L, T = rotate_factors(A,<span class="string">&#x27;quartimin&#x27;</span>,<span class="number">0.5</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.allclose(L,A.dot(np.linalg.inv(T.T)))  </span><br></pre></td></tr></table></figure>
<h2 id="典型相关canonical-correlation"><a class="markdownIt-Anchor" href="#典型相关canonical-correlation"></a> 典型相关(Canonical Correlation)</h2>
<p>典型相关分析（canonical correlation analysis），是对互协方差矩阵的一种理解，是利用综合变量对之间的相关关系来反映两组指标之间的整体相关性的多元统计分析方法。它的基本原理是：为了从总体上把握两组指标之间的相关关系，分别在两组变量中提取有代表性的两个综合变量U1和V1（分别为两个变量组中各变量的线性组合），利用这两个综合变量之间的相关关系来反映两组指标之间的整体相关性。</p>
<p><code>CanCorr(endog, exog,...) # 使用单因素分解的典型相关分析</code></p>
<h2 id="多元方差分析manova"><a class="markdownIt-Anchor" href="#多元方差分析manova"></a> 多元方差分析(MANOVA)</h2>
<p>在统计学中，多元方差分析（MANOVA）是一种比较多变量样本均值的程序 。作为一个多变量过程，它在有两个或多个因变量时使用，并且通常后面是分别涉及各个因变量的显着性检验。</p>
<p>MANOVA是单变量方差分析（ANOVA）的推广形式，尽管与单变量ANOVA不同，它使用结果变量之间的协方差来检验平均差异的统计显着性。其中，在单变量方差分析中出现平方和的情况下，在多变量方差分析中出现某些正定矩阵。对角线条目是出现在单变量ANOVA中的相同种类的平方和，非对角线条目则是相应的乘积和。在关于误差分布的正态假设下，由于误差导致的平方和对应部分服从Wishart分布。</p>
<p><code>MANOVA(endog, exog,...)</code></p>
<h2 id="多元线性模型multivariateols"><a class="markdownIt-Anchor" href="#多元线性模型multivariateols"></a> 多元线性模型(MultivariateOLS)</h2>
<p><code>_MultivariateOLS</code>是一个功能有限的模型类。目前它支持多变量假设检验，并用作MANOVA的后端</p>
<h1 id="可视化"><a class="markdownIt-Anchor" href="#可视化"></a> 可视化</h1>
<h2 id="拟合图"><a class="markdownIt-Anchor" href="#拟合图"></a> 拟合图</h2>
<table>
<thead>
<tr>
<th style="text-align:left">Goodness of Fit Plots</th>
<th style="text-align:left">拟合图</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">gofplots.qqplot</td>
<td style="text-align:left">QQ图。</td>
</tr>
<tr>
<td style="text-align:left">gofplots.qqline</td>
<td style="text-align:left">绘制一个qqplot的参考线</td>
</tr>
<tr>
<td style="text-align:left">gofplots.qqplot_2samples</td>
<td style="text-align:left">两个样本分位数的QQ图</td>
</tr>
<tr>
<td style="text-align:left">gofplots.ProbPlot</td>
<td style="text-align:left">自定义QQ图，PP图或概率图</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> scipy.stats <span class="keyword">as</span> stats  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = sm.datasets.longley.load()  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data.exog = sm.add_constant(data.exog)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mod_fit = sm.OLS(data.endog, data.exog).fit()  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res = mod_fit.resid <span class="comment"># residuals  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fig = sm.qqplot(res, stats.t, fit=<span class="literal">True</span>, line=<span class="string">&#x27;45&#x27;</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>plt.show()  </span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/fit.png" alt="qq" /></p>
<h2 id="箱线图"><a class="markdownIt-Anchor" href="#箱线图"></a> 箱线图</h2>
<table>
<thead>
<tr>
<th style="text-align:left">Boxplots</th>
<th style="text-align:left">箱线图</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">boxplots.violinplot</td>
<td style="text-align:left">在数据序列中为每个数据集制作小提琴图</td>
</tr>
<tr>
<td style="text-align:left">boxplots.beanplot</td>
<td style="text-align:left">在数据序列中创建每个数据集的bean图</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = sm.datasets.anes96.load_pandas()  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>party_ID = np.arange(<span class="number">7</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>labels = [<span class="string">&quot;Strong Democrat&quot;</span>, <span class="string">&quot;Weak Democrat&quot;</span>, <span class="string">&quot;Independent-Democrat&quot;</span>,  </span><br><span class="line"><span class="meta">... </span>          <span class="string">&quot;Independent-Indpendent&quot;</span>, <span class="string">&quot;Independent-Republican&quot;</span>,  </span><br><span class="line"><span class="meta">... </span>          <span class="string">&quot;Weak Republican&quot;</span>, <span class="string">&quot;Strong Republican&quot;</span>]  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>plt.rcParams[<span class="string">&#x27;figure.subplot.bottom&#x27;</span>] = <span class="number">0.23</span>  <span class="comment"># keep labels visible  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>age = [data.exog[<span class="string">&#x27;age&#x27;</span>][data.endog == <span class="built_in">id</span>] <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> party_ID]  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fig = plt.figure()  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax = fig.add_subplot(<span class="number">111</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sm.graphics.violinplot(age, ax=ax, labels=labels,  </span><br><span class="line"><span class="meta">... </span>                       plot_opts=&#123;<span class="string">&#x27;cutoff_val&#x27;</span>:<span class="number">5</span>, <span class="string">&#x27;cutoff_type&#x27;</span>:<span class="string">&#x27;abs&#x27;</span>,  </span><br><span class="line"><span class="meta">... </span>                                  <span class="string">&#x27;label_fontsize&#x27;</span>:<span class="string">&#x27;small&#x27;</span>,  </span><br><span class="line"><span class="meta">... </span>                                  <span class="string">&#x27;label_rotation&#x27;</span>:<span class="number">30</span>&#125;)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax.set_xlabel(<span class="string">&quot;Party identification of respondent.&quot;</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax.set_ylabel(<span class="string">&quot;Age&quot;</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>plt.show()  </span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/box.png" alt="" /></p>
<h2 id="相关图"><a class="markdownIt-Anchor" href="#相关图"></a> 相关图</h2>
<table>
<thead>
<tr>
<th style="text-align:left">Correlation Plots</th>
<th style="text-align:left">相关图</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">correlation.plot_corr</td>
<td style="text-align:left">相关图</td>
</tr>
<tr>
<td style="text-align:left">correlation.plot_corr_grid</td>
<td style="text-align:left">创建相关图的网格</td>
</tr>
<tr>
<td style="text-align:left">plot_grids.scatter_ellipse</td>
<td style="text-align:left">用置信度椭圆创建一个散点图网格</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> statsmodels.graphics.api <span class="keyword">as</span> smg  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hie_data = sm.datasets.randhie.load_pandas()  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>corr_matrix = np.corrcoef(hie_data.data.T)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>smg.plot_corr(corr_matrix, xnames=hie_data.names)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>plt.show()  </span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/corr.png" alt="" /></p>
<h2 id="函数图"><a class="markdownIt-Anchor" href="#函数图"></a> 函数图</h2>
<table>
<thead>
<tr>
<th style="text-align:left">Functional Plots</th>
<th style="text-align:left">函数图</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">functional.hdrboxplot</td>
<td style="text-align:left">高密度区域箱线图</td>
</tr>
<tr>
<td style="text-align:left">functional.fboxplot</td>
<td style="text-align:left">绘制函数箱线图</td>
</tr>
<tr>
<td style="text-align:left">functional.rainbowplot</td>
<td style="text-align:left">为一组曲线创建一个彩虹图</td>
</tr>
<tr>
<td style="text-align:left">functional.banddepth</td>
<td style="text-align:left">计算一组函数曲线的带深度</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> statsmodels.api <span class="keyword">as</span> sm  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = sm.datasets.elnino.load()  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fig = plt.figure()  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax = fig.add_subplot(<span class="number">111</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>res = sm.graphics.hdrboxplot(data.raw_data[:, <span class="number">1</span>:],  </span><br><span class="line"><span class="meta">... </span>                             labels=data.raw_data[:, <span class="number">0</span>].astype(<span class="built_in">int</span>),  </span><br><span class="line"><span class="meta">... </span>                             ax=ax)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax.set_xlabel(<span class="string">&quot;Month of the year&quot;</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax.set_ylabel(<span class="string">&quot;Sea surface temperature (C)&quot;</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax.set_xticks(np.arange(<span class="number">13</span>, step=<span class="number">3</span>) - <span class="number">1</span>)  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax.set_xticklabels([<span class="string">&quot;&quot;</span>, <span class="string">&quot;Mar&quot;</span>, <span class="string">&quot;Jun&quot;</span>, <span class="string">&quot;Sep&quot;</span>, <span class="string">&quot;Dec&quot;</span>])  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ax.set_xlim([-<span class="number">0.2</span>, <span class="number">11.2</span>])  </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>plt.show()  </span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://warehouse-1310574346.cos.ap-shanghai.myqcloud.com/images/statsmodels/fun.png" alt="fp" /></p>
<h2 id="回归图"><a class="markdownIt-Anchor" href="#回归图"></a> 回归图</h2>
<table>
<thead>
<tr>
<th style="text-align:left">Regression Plots</th>
<th style="text-align:left">回归图</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">regressionplots.plot_fit</td>
<td style="text-align:left">Plot fit against one regressor</td>
</tr>
<tr>
<td style="text-align:left">regressionplots.plot_regress_exog</td>
<td style="text-align:left">针对一个回归模型绘制回归结果。</td>
</tr>
<tr>
<td style="text-align:left">regressionplots.plot_partregress</td>
<td style="text-align:left">绘制对于单个回归模型的部分回归。</td>
</tr>
<tr>
<td style="text-align:left">regressionplots.plot_ccpr</td>
<td style="text-align:left">将CCPR与一位回归模型对比。</td>
</tr>
<tr>
<td style="text-align:left">regressionplots.abline_plot</td>
<td style="text-align:left">绘制斜线</td>
</tr>
<tr>
<td style="text-align:left">regressionplots.influence_plot</td>
<td style="text-align:left">回归影响</td>
</tr>
<tr>
<td style="text-align:left">regressionplots.plot_leverage_resid2</td>
<td style="text-align:left">Plots leverage statistics vs</td>
</tr>
</tbody>
</table>
<h2 id="时间序列图"><a class="markdownIt-Anchor" href="#时间序列图"></a> 时间序列图</h2>
<table>
<thead>
<tr>
<th style="text-align:left">Time Series Plots</th>
<th style="text-align:left">时间序列图</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">tsaplots.plot_acf</td>
<td style="text-align:left">绘制自相关函数</td>
</tr>
<tr>
<td style="text-align:left">tsaplots.plot_pacf</td>
<td style="text-align:left">绘制部分自相关函数</td>
</tr>
<tr>
<td style="text-align:left">tsaplots.month_plot</td>
<td style="text-align:left">每月数据的季节性</td>
</tr>
<tr>
<td style="text-align:left">tsaplots.quarter_plot</td>
<td style="text-align:left">季度数据的季节性</td>
</tr>
</tbody>
</table>
<h2 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h2>
<table>
<thead>
<tr>
<th style="text-align:left">Other Plots</th>
<th style="text-align:left">其他</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">factorplots.interaction_plot</td>
<td style="text-align:left">对每个因子水平的交互作用图</td>
</tr>
<tr>
<td style="text-align:left">mosaicplot.mosaic</td>
<td style="text-align:left">马赛克图</td>
</tr>
<tr>
<td style="text-align:left">agreement.mean_diff_plot</td>
<td style="text-align:left">Tukey’s Mean Difference Plot</td>
</tr>
</tbody>
</table>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><a class="post-meta__tags" href="/tags/python/">python</a></div><div class="post_share"><div class="social-share" data-image="/img/statsmodels.svg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/morty3.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/morty3.jpg" alt="Give me money!"/></a><div class="post-qr-code-desc">Give me money!</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/861261b5/" title="Python手册(Machine Learning)--sklearn"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/sklearn-cover.svg" onerror="onerror=null;src='/img/404_moon.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python手册(Machine Learning)--sklearn</div></div></a></div><div class="next-post pull-right"><a href="/posts/49513cf1/" title="Python手册(Visualise)--seaborn"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/seaborn-cover.svg" onerror="onerror=null;src='/img/404_moon.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Python手册(Visualise)--seaborn</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/75974533/" title="大数据手册(Spark)--PySpark MLlib"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/apache-spark-mllib.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-09</div><div class="title">大数据手册(Spark)--PySpark MLlib</div></div></a></div><div><a href="/posts/861261b5/" title="Python手册(Machine Learning)--sklearn"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/sklearn-cover.svg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-05-10</div><div class="title">Python手册(Machine Learning)--sklearn</div></div></a></div><div><a href="/posts/cc734464/" title="机器学习(III)--模型选择与评估"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ML-model-selection-and-evaluation.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-27</div><div class="title">机器学习(III)--模型选择与评估</div></div></a></div><div><a href="/posts/8638abf9/" title="机器学习(I)--基础知识"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ML-overview.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-02</div><div class="title">机器学习(I)--基础知识</div></div></a></div><div><a href="/posts/5faa8f40/" title="机器学习(II)--数据预处理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ML-data-preprocessing.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-03</div><div class="title">机器学习(II)--数据预处理</div></div></a></div><div><a href="/posts/43ce4abf/" title="机器学习(V)--无监督学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ML-unsupervised-learning.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-07</div><div class="title">机器学习(V)--无监督学习</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Gitalk</span><span class="switch-btn"></span><span class="second-comment">Waline</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Tiny Lei</div><div class="author-info__description">每天进步一点点...</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">134</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">103</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">42</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://gitee.com/wilenwu" rel="external nofollow noreferrer" target="_blank" title="Gitee"><i class="iconfont icon-gitee"></i></a><a class="social-icon" href="https://github.com/wilenwu" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_41518277" rel="external nofollow noreferrer" target="_blank" title="CSDN"><i class="iconfont icon-csdn"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="iconfont icon-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">感谢访问本站，若喜欢请收藏^_^</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text"> 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%8B%9F%E5%90%88%E5%92%8C%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text"> 模型拟合和描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text"> 输入输出模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%B5%8B%E8%AF%95%E5%92%8C%E7%BB%98%E5%9B%BE"><span class="toc-number">1.3.</span> <span class="toc-text"> 模型测试和绘图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8r%E5%9E%8B%E5%85%AC%E5%BC%8F%E6%9D%A5%E6%8B%9F%E5%90%88%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text"> 使用R型公式来拟合模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#statsmodels%E5%8F%82%E6%95%B0"><span class="toc-number">1.5.</span> <span class="toc-text"> statsmodels参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%92%8C%E6%8B%9F%E5%90%88%E7%BB%93%E6%9E%9C%E7%9A%84%E8%B6%85%E7%B1%BB"><span class="toc-number">1.6.</span> <span class="toc-text"> 模型和拟合结果的超类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text"> 回归分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#linear-regression%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92"><span class="toc-number">2.1.</span> <span class="toc-text"> Linear Regression(线性回归)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#generalized-linear%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92"><span class="toc-number">2.2.</span> <span class="toc-text"> Generalized Linear(广义线性回归)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#generalized-estimating-equations%E5%B9%BF%E4%B9%89%E4%BC%B0%E8%AE%A1%E6%96%B9%E7%A8%8B"><span class="toc-number">2.3.</span> <span class="toc-text"> Generalized Estimating Equations(广义估计方程)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#robust-linear-models%E7%A8%B3%E5%81%A5%E7%9A%84%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.4.</span> <span class="toc-text"> Robust Linear Models(稳健的线性模型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linear-mixed-effects-models%E7%BA%BF%E6%80%A7%E6%B7%B7%E5%90%88%E6%95%88%E5%BA%94%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.5.</span> <span class="toc-text"> Linear Mixed Effects Models(线性混合效应模型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#regression-with-discrete-dependent-variable%E7%A6%BB%E6%95%A3%E5%9B%A0%E5%8F%98%E9%87%8F%E5%9B%9E%E5%BD%92"><span class="toc-number">2.6.</span> <span class="toc-text"> Regression with Discrete Dependent Variable(离散因变量回归)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#generalized-linear-mixed-effects-models%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E6%B7%B7%E5%90%88%E6%95%88%E5%BA%94%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.7.</span> <span class="toc-text"> Generalized Linear Mixed Effects Models(广义线性混合效应模型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90"><span class="toc-number">2.8.</span> <span class="toc-text"> 方差分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text"> 时间序列分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.1.</span> <span class="toc-text"> 时间序列模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text"> 常用模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arima%E6%A8%A1%E5%9E%8B%E8%BF%90%E7%94%A8%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.2.</span> <span class="toc-text"> ARIMA模型运用的流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arma-example-sunspots-data"><span class="toc-number">3.1.3.</span> <span class="toc-text"> ARMA example: Sunspots data</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A9%BA%E9%97%B4%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text"> 状态空间方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%84%8F%E4%B9%89"><span class="toc-number">3.2.1.</span> <span class="toc-text"> 模型意义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A9%BA%E9%97%B4%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BB%BA%E7%AB%8B%E5%92%8C%E9%A2%84%E6%B5%8B%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.2.2.</span> <span class="toc-text"> 状态空间模型的建立和预测的步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A2%E9%87%8F%E8%87%AA%E5%9B%9E%E5%BD%92"><span class="toc-number">3.3.</span> <span class="toc-text"> 矢量自回归</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#var%E8%BF%9B%E7%A8%8Bvar-processes"><span class="toc-number">3.3.1.</span> <span class="toc-text"> VAR进程(VAR processes)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%8B%9F%E5%90%88model-fitting"><span class="toc-number">3.3.2.</span> <span class="toc-text"> 模型拟合(Model fitting)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BB%9E%E5%90%8E%E9%A1%BA%E5%BA%8F%E9%80%89%E6%8B%A9lag-order-selection"><span class="toc-number">3.3.3.</span> <span class="toc-text"> 滞后顺序选择(Lag order selection)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E6%B5%8Bforecasting"><span class="toc-number">3.3.4.</span> <span class="toc-text"> 预测(Forecasting)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%89%E5%86%B2%E5%93%8D%E5%BA%94%E5%88%86%E6%9E%90impulse-response-analysis"><span class="toc-number">3.3.5.</span> <span class="toc-text"> 脉冲响应分析(Impulse Response Analysis)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E6%B5%8B%E8%AF%AF%E5%B7%AE%E6%96%B9%E5%B7%AE%E5%88%86%E8%A7%A3fevd"><span class="toc-number">3.3.6.</span> <span class="toc-text"> 预测误差方差分解(FEVD)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E6%A3%80%E9%AA%8Cstatistical-tests"><span class="toc-number">3.3.7.</span> <span class="toc-text"> 统计检验(Statistical tests)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%9F%A2%E9%87%8F%E8%87%AA%E5%8A%A8%E5%9B%9E%E5%BD%92dynamic-vector-autoregressions"><span class="toc-number">3.3.8.</span> <span class="toc-text"> 动态矢量自动回归(Dynamic Vector Autoregressions)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%9F%E5%AD%98%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text"> 生存分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E5%AD%98%E5%87%BD%E6%95%B0%E4%BC%B0%E8%AE%A1%E5%92%8C%E6%8E%A8%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text"> 生存函数估计和推理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E5%BD%92%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.</span> <span class="toc-text"> 回归方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%97%E8%81%94%E8%A1%A8"><span class="toc-number">5.</span> <span class="toc-text"> 列联表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#independence%E7%8B%AC%E7%AB%8B%E6%80%A7"><span class="toc-number">5.1.</span> <span class="toc-text"> Independence(独立性)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#symmetry-and-homogeneity%E5%AF%B9%E7%A7%B0%E6%80%A7%E5%92%8C%E5%90%8C%E8%B4%A8%E6%80%A7"><span class="toc-number">5.2.</span> <span class="toc-text"> Symmetry and homogeneity(对称性和同质性)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#a-single-2x2-table%E5%8D%95%E4%B8%AA2x2%E8%A1%A8"><span class="toc-number">5.3.</span> <span class="toc-text"> A single 2x2 table(单个2x2表)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stratified-2x2-tables%E5%88%86%E5%B1%822x2%E8%A1%A8"><span class="toc-number">5.4.</span> <span class="toc-text"> Stratified 2x2 tables(分层2x2表)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E6%8F%92%E8%A1%A5"><span class="toc-number">6.</span> <span class="toc-text"> 多重插补</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E5%8F%98%E9%87%8F%E7%BB%9F%E8%AE%A1"><span class="toc-number">7.</span> <span class="toc-text"> 多变量统计</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%90principal-component-analysis"><span class="toc-number">7.1.</span> <span class="toc-text"> 主成分分析(Principal Component Analysis)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%A0%E5%AD%90%E5%88%86%E6%9E%90factor-analysis"><span class="toc-number">7.2.</span> <span class="toc-text"> 因子分析(Factor Analysis)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B8%E5%9E%8B%E7%9B%B8%E5%85%B3canonical-correlation"><span class="toc-number">7.3.</span> <span class="toc-text"> 典型相关(Canonical Correlation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%85%83%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90manova"><span class="toc-number">7.4.</span> <span class="toc-text"> 多元方差分析(MANOVA)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%85%83%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8Bmultivariateols"><span class="toc-number">7.5.</span> <span class="toc-text"> 多元线性模型(MultivariateOLS)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">8.</span> <span class="toc-text"> 可视化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%9F%E5%90%88%E5%9B%BE"><span class="toc-number">8.1.</span> <span class="toc-text"> 拟合图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%B1%E7%BA%BF%E5%9B%BE"><span class="toc-number">8.2.</span> <span class="toc-text"> 箱线图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%9B%BE"><span class="toc-number">8.3.</span> <span class="toc-text"> 相关图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%9B%BE"><span class="toc-number">8.4.</span> <span class="toc-text"> 函数图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E5%BD%92%E5%9B%BE"><span class="toc-number">8.5.</span> <span class="toc-text"> 回归图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%9B%BE"><span class="toc-number">8.6.</span> <span class="toc-text"> 时间序列图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">8.7.</span> <span class="toc-text"> 其他</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/40113498/" title="线性代数引论"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/Linear-Algebra.png" onerror="this.onerror=null;this.src='/img/404_moon.png'" alt="线性代数引论"/></a><div class="content"><a class="title" href="/posts/40113498/" title="线性代数引论">线性代数引论</a><time datetime="2023-07-13T15:28:34.000Z" title="发表于 2023-07-13 23:28:34">2023-07-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f67b0909/" title="大数据手册(Spark)--Pandas API on Spark"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/apache-spark-pandas.png" onerror="this.onerror=null;this.src='/img/404_moon.png'" alt="大数据手册(Spark)--Pandas API on Spark"/></a><div class="content"><a class="title" href="/posts/f67b0909/" title="大数据手册(Spark)--Pandas API on Spark">大数据手册(Spark)--Pandas API on Spark</a><time datetime="2023-06-07T15:09:56.599Z" title="发表于 2023-06-07 23:09:56">2023-06-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d56d6970/" title="量子场论"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/openbook.jpg" onerror="this.onerror=null;this.src='/img/404_moon.png'" alt="量子场论"/></a><div class="content"><a class="title" href="/posts/d56d6970/" title="量子场论">量子场论</a><time datetime="2023-06-07T15:09:52.865Z" title="发表于 2023-06-07 23:09:52">2023-06-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/43ce4abf/" title="机器学习(V)--无监督学习"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ML-unsupervised-learning.png" onerror="this.onerror=null;this.src='/img/404_moon.png'" alt="机器学习(V)--无监督学习"/></a><div class="content"><a class="title" href="/posts/43ce4abf/" title="机器学习(V)--无监督学习">机器学习(V)--无监督学习</a><time datetime="2023-06-07T14:20:00.000Z" title="发表于 2023-06-07 22:20:00">2023-06-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faa8f40/" title="机器学习(II)--数据预处理"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/ML-data-preprocessing.png" onerror="this.onerror=null;this.src='/img/404_moon.png'" alt="机器学习(II)--数据预处理"/></a><div class="content"><a class="title" href="/posts/5faa8f40/" title="机器学习(II)--数据预处理">机器学习(II)--数据预处理</a><time datetime="2023-05-03T06:36:00.000Z" title="发表于 2023-05-03 14:36:00">2023-05-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By Tiny Lei</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="/false"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'forest'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '7c65134b48b13f306114',
      clientSecret: 'f049f68368a11925fdb69e57c64839eac94e13c1'',
      repo: 'gitalk-comments',
      owner: 'WilenWu',
      admin: ['WilenWu'],
      id: 'aea58e918b9e69ae691651fc245e5f7e',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.textContent= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script>function loadWaline () {
  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline-comments-9etq63pcv-wilenwu.vercel.app',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, {"requiredMeta":["monsterid"]}))
  }

  if (typeof Waline === 'object') initWaline()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css').then(() => {
      getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(initWaline)
    })
  }
}

if ('Gitalk' === 'Waline' || !true) {
  if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script src="/js/custom.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>